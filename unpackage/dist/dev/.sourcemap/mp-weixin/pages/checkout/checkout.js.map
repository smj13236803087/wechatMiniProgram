{"version":3,"file":"checkout.js","sources":["pages/checkout/checkout.vue","pages/checkout/checkout.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"checkout-container\">\n\t\t<scroll-view class=\"content\" scroll-y>\n\t\t\t<!-- 收货地址 -->\n\t\t\t<view class=\"address-card\">\n\t\t\t\t<view class=\"card-title\">收货地址</view>\n\t\t\t\t<view v-if=\"loadingAddress\" class=\"loading-text\">加载地址中...</view>\n\t\t\t\t<view v-else-if=\"!defaultAddress\" class=\"empty-address\" @click=\"goToAddresses\">\n\t\t\t\t\t<text class=\"empty-text\">请选择收货地址</text>\n\t\t\t\t\t<text class=\"empty-arrow\">›</text>\n\t\t\t\t</view>\n\t\t\t\t<view v-else class=\"address-info\" @click=\"goToAddresses\">\n\t\t\t\t\t<view class=\"address-top\">\n\t\t\t\t\t\t<text class=\"address-name\">{{ defaultAddress.recipient }}</text>\n\t\t\t\t\t\t<text class=\"address-phone\">{{ defaultAddress.phone }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"address-bottom\">\n\t\t\t\t\t\t<text class=\"address-full\">\n\t\t\t\t\t\t\t{{ defaultAddress.country }} {{ defaultAddress.province }} {{ defaultAddress.city }} {{ defaultAddress.district }} {{ defaultAddress.detail }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"address-arrow\">›</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 商品信息 -->\n\t\t\t<view class=\"goods-card\">\n\t\t\t\t<view class=\"card-title\">商品信息</view>\n\t\t\t\t<view v-for=\"(item, index) in orderItems\" :key=\"item.id || index\" class=\"goods-item\">\n\t\t\t\t\t<view class=\"goods-preview\">\n\t\t\t\t\t\t<canvas :canvas-id=\"'checkout-preview-' + item.id\" class=\"preview-canvas\"></canvas>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"goods-info\">\n\t\t\t\t\t\t<view class=\"goods-name\">{{ item.name }}</view>\n\t\t\t\t\t\t<view class=\"goods-meta\">\n\t\t\t\t\t\t\t<text class=\"goods-count\">{{ (item.design?.items?.length || 0) }} 件</text>\n\t\t\t\t\t\t\t<text class=\"goods-qty\">×{{ item.quantity }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"goods-price\">¥{{ item.totalPrice }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 订单信息 -->\n\t\t\t<view class=\"order-info-card\">\n\t\t\t\t<view class=\"card-title\">订单信息</view>\n\t\t\t\t<view class=\"info-row\">\n\t\t\t\t\t<text class=\"info-label\">商品件数</text>\n\t\t\t\t\t<text class=\"info-value\">{{ totalQuantity }} 件</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"info-row\">\n\t\t\t\t\t<text class=\"info-label\">商品总价</text>\n\t\t\t\t\t<text class=\"info-value\">¥{{ totalPrice }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\n\t\t<!-- 底部操作条 -->\n\t\t<view class=\"footer\">\n\t\t\t<view class=\"footer-left\">\n\t\t\t\t<text class=\"footer-label\">合计：</text>\n\t\t\t\t<text class=\"footer-price\">¥{{ totalPrice }}</text>\n\t\t\t</view>\n\t\t\t<button\n\t\t\t\tclass=\"submit-btn\"\n\t\t\t\t:disabled=\"submitting || !defaultAddress\"\n\t\t\t\t@click=\"handleSubmitOrder\"\n\t\t\t>\n\t\t\t\t{{ submitting ? '提交中...' : '提交订单' }}\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { addressAPI } from '@/utils/api.js'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\torderItems: [],\n\t\t\ttotalPrice: 0,\n\t\t\tdefaultAddress: null,\n\t\t\tloadingAddress: true,\n\t\t\tsubmitting: false\n\t\t}\n\t},\n\tcomputed: {\n\t\ttotalQuantity() {\n\t\t\treturn this.orderItems.reduce((sum, item) => sum + (item.quantity || 1), 0)\n\t\t}\n\t},\n\tonLoad(options) {\n\t\tif (options && options.data) {\n\t\t\ttry {\n\t\t\t\tconst payload = JSON.parse(decodeURIComponent(options.data))\n\t\t\t\tthis.orderItems = payload.items || []\n\t\t\t\tthis.totalPrice = payload.totalPrice || 0\n\t\t\t\t// 绘制商品预览图\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawAllPreviews()\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('解析订单数据失败', e)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '订单数据错误',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.fetchDefaultAddress()\n\t},\n\tmethods: {\n\t\tasync fetchDefaultAddress() {\n\t\t\tthis.loadingAddress = true\n\t\t\ttry {\n\t\t\t\tconst res = await addressAPI.getAddresses()\n\t\t\t\tconst addresses = res.addresses || []\n\t\t\t\t// 查找默认地址\n\t\t\t\tthis.defaultAddress = addresses.find(addr => addr.isDefault) || addresses[0] || null\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('获取地址失败：', err)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '获取地址失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t} finally {\n\t\t\t\tthis.loadingAddress = false\n\t\t\t}\n\t\t},\n\t\t\n\t\tdrawAllPreviews() {\n\t\t\tthis.orderItems.forEach((item) => {\n\t\t\t\tconst designItems = item.design?.items || []\n\t\t\t\tif (Array.isArray(designItems) && designItems.length > 0) {\n\t\t\t\t\tthis.drawPreview(item.id, designItems)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\t\n\t\t// 绘制预览图（与购物车/作品集相同的算法）\n\t\tdrawPreview(itemId, items) {\n\t\t\tconst canvasId = 'checkout-preview-' + itemId\n\t\t\tconst ctx = uni.createCanvasContext(canvasId, this)\n\t\t\t\n\t\t\tconst systemInfo = uni.getSystemInfoSync()\n\t\t\tconst screenWidth = systemInfo.screenWidth\n\t\t\tconst size = (180 / 750) * screenWidth // 180rpx\n\t\t\tconst centerX = size / 2\n\t\t\tconst centerY = size / 2\n\t\t\t\n\t\t\tctx.clearRect(0, 0, size, size)\n\t\t\t\n\t\t\tconst baseBeadRadius = 8\n\t\t\tconst margin = 6\n\t\t\tconst maxRadius = size / 2 - baseBeadRadius - margin\n\t\t\tif (maxRadius <= 0) {\n\t\t\t\tctx.draw()\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tconst minCircumference = items.length * baseBeadRadius * 2\n\t\t\tconst minRadius = minCircumference / (2 * Math.PI)\n\t\t\t\n\t\t\tlet beadRadius = baseBeadRadius\n\t\t\tlet radius\n\t\t\t\n\t\t\tif (minRadius <= maxRadius) {\n\t\t\t\tradius = Math.max(minRadius + beadRadius * 0.5, size * 0.25)\n\t\t\t\tradius = Math.min(radius, maxRadius)\n\t\t\t} else {\n\t\t\t\tconst scale = maxRadius / minRadius\n\t\t\t\tbeadRadius = baseBeadRadius * scale\n\t\t\t\tradius = maxRadius\n\t\t\t}\n\t\t\t\n\t\t\t// 绘制圆形虚线路径\n\t\t\tctx.beginPath()\n\t\t\tctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)\n\t\t\tctx.setStrokeStyle('#e5e7eb')\n\t\t\tctx.setLineWidth(2)\n\t\t\tctx.setLineDash([5, 5], 0)\n\t\t\tctx.stroke()\n\t\t\tctx.setLineDash([], 0)\n\t\t\t\n\t\t\t// 均匀分布角度\n\t\t\tconst totalAngle = 2 * Math.PI\n\t\t\tconst angleStep = totalAngle / items.length\n\t\t\t\n\t\t\titems.forEach((item, index) => {\n\t\t\t\tconst angle = index * angleStep\n\t\t\t\tconst x = centerX + radius * Math.cos(angle)\n\t\t\t\tconst y = centerY + radius * Math.sin(angle)\n\t\t\t\tconst color = item.color || '#8b4513'\n\t\t\t\t\n\t\t\t\tctx.beginPath()\n\t\t\t\tctx.arc(x, y, beadRadius, 0, 2 * Math.PI)\n\t\t\t\tctx.setFillStyle(color)\n\t\t\t\tctx.fill()\n\t\t\t\t\n\t\t\t\tctx.setStrokeStyle('#ffffff')\n\t\t\t\tctx.setLineWidth(1.5)\n\t\t\t\tctx.stroke()\n\t\t\t})\n\t\t\t\n\t\t\tctx.draw()\n\t\t},\n\t\t\n\t\tgoToAddresses() {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/address/address'\n\t\t\t})\n\t\t},\n\t\t\n\t\t// 提交订单（预留，暂不实现）\n\t\thandleSubmitOrder() {\n\t\t\tif (!this.defaultAddress) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '请先选择收货地址',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.submitting) return\n\t\t\t\n\t\t\t// 预留：提交订单逻辑待实现\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '提交订单功能开发中',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t}\n}\n</script>\n\n<style scoped>\n.checkout-container {\n\tmin-height: 100vh;\n\tbackground: #f3f4f6;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.content {\n\tflex: 1;\n\tpadding: 24rpx 24rpx 140rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 24rpx;\n}\n\n.address-card,\n.goods-card,\n.order-info-card {\n\tbackground: #ffffff;\n\tborder-radius: 16rpx;\n\tpadding: 24rpx;\n}\n\n.card-title {\n\tfont-size: 28rpx;\n\tfont-weight: 600;\n\tcolor: #111827;\n\tmargin-bottom: 20rpx;\n}\n\n.loading-text {\n\tfont-size: 26rpx;\n\tcolor: #6b7280;\n\ttext-align: center;\n\tpadding: 40rpx 0;\n}\n\n.empty-address {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 32rpx 0;\n\tborder-top: 1rpx solid #f3f4f6;\n}\n\n.empty-text {\n\tfont-size: 28rpx;\n\tcolor: #6b7280;\n}\n\n.empty-arrow {\n\tfont-size: 40rpx;\n\tcolor: #d1d5db;\n}\n\n.address-info {\n\tposition: relative;\n\tpadding: 24rpx 0;\n\tborder-top: 1rpx solid #f3f4f6;\n}\n\n.address-top {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 24rpx;\n\tmargin-bottom: 12rpx;\n}\n\n.address-name {\n\tfont-size: 30rpx;\n\tfont-weight: 600;\n\tcolor: #111827;\n}\n\n.address-phone {\n\tfont-size: 28rpx;\n\tcolor: #6b7280;\n}\n\n.address-bottom {\n\tmargin-top: 8rpx;\n}\n\n.address-full {\n\tfont-size: 26rpx;\n\tcolor: #6b7280;\n\tline-height: 1.6;\n}\n\n.address-arrow {\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tfont-size: 40rpx;\n\tcolor: #d1d5db;\n}\n\n.goods-item {\n\tdisplay: flex;\n\tflex-direction: row;\n\tgap: 20rpx;\n\tpadding: 20rpx 0;\n\tborder-bottom: 1rpx solid #f3f4f6;\n}\n\n.goods-item:last-child {\n\tborder-bottom: none;\n}\n\n.goods-preview {\n\twidth: 180rpx;\n\theight: 180rpx;\n\tbackground: #f9fafb;\n\tborder-radius: 12rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\toverflow: hidden;\n\tflex-shrink: 0;\n}\n\n.preview-canvas {\n\twidth: 180rpx;\n\theight: 180rpx;\n}\n\n.goods-info {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.goods-name {\n\tfont-size: 28rpx;\n\tfont-weight: 500;\n\tcolor: #111827;\n\tmargin-bottom: 12rpx;\n}\n\n.goods-meta {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 16rpx;\n\tmargin-bottom: 12rpx;\n}\n\n.goods-count {\n\tfont-size: 24rpx;\n\tcolor: #6b7280;\n}\n\n.goods-qty {\n\tfont-size: 24rpx;\n\tcolor: #6b7280;\n}\n\n.goods-price {\n\tfont-size: 30rpx;\n\tfont-weight: 600;\n\tcolor: #ef4444;\n}\n\n.info-row {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 16rpx 0;\n\tborder-bottom: 1rpx solid #f3f4f6;\n}\n\n.info-row:last-child {\n\tborder-bottom: none;\n}\n\n.info-label {\n\tfont-size: 26rpx;\n\tcolor: #6b7280;\n}\n\n.info-value {\n\tfont-size: 26rpx;\n\tcolor: #111827;\n\tfont-weight: 500;\n}\n\n.footer {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tpadding: 16rpx 24rpx 24rpx;\n\tbackground: #ffffff;\n\tbox-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.06);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 16rpx;\n}\n\n.footer-left {\n\tdisplay: flex;\n\talign-items: baseline;\n\tgap: 8rpx;\n}\n\n.footer-label {\n\tfont-size: 24rpx;\n\tcolor: #6b7280;\n}\n\n.footer-price {\n\tfont-size: 36rpx;\n\tfont-weight: 700;\n\tcolor: #ef4444;\n}\n\n.submit-btn {\n\tflex: 0 0 200rpx;\n\theight: 80rpx;\n\tborder-radius: 999rpx;\n\tbackground: linear-gradient(135deg, #10b981, #059669);\n\tcolor: #ffffff;\n\tfont-size: 28rpx;\n\tfont-weight: 600;\n\tborder: none;\n}\n\n.submit-btn[disabled] {\n\topacity: 0.6;\n}\n</style>\n","import MiniProgramPage from '/Users/shaomaojia/Documents/HBuilderProjects/bracelet/pages/checkout/checkout.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","addressAPI"],"mappings":"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"}