{"version":3,"file":"api.js","sources":["utils/api.js"],"sourcesContent":["// API工具类\n// 注意：需要根据实际情况修改BASE_URL\n// 开发环境：http://localhost:3000\n// 生产环境：需要修改为实际域名，例如：https://your-domain.com\nconst BASE_URL = 'http://localhost:3000' // 请根据实际情况修改\n\n// Cookie存储（小程序中需要手动管理cookie）\nlet storedCookies = {}\n\n// 从响应头中提取cookie\nfunction extractCookies(setCookieHeader) {\n  if (!setCookieHeader) return\n  const cookies = Array.isArray(setCookieHeader) ? setCookieHeader : [setCookieHeader]\n  cookies.forEach(cookieStr => {\n    const parts = cookieStr.split(';')[0].split('=')\n    if (parts.length === 2) {\n      storedCookies[parts[0].trim()] = parts[1].trim()\n    }\n  })\n}\n\n// 生成Cookie请求头\nfunction getCookieHeader() {\n  return Object.entries(storedCookies)\n    .map(([key, value]) => `${key}=${value}`)\n    .join('; ')\n}\n\n// 统一请求方法\nfunction request(url, options = {}) {\n  return new Promise((resolve, reject) => {\n    const headers = {\n      'Content-Type': 'application/json',\n      ...options.header\n    }\n    \n    // 添加Cookie到请求头\n    const cookieHeader = getCookieHeader()\n    if (cookieHeader) {\n      headers['Cookie'] = cookieHeader\n    }\n    \n    uni.request({\n      url: BASE_URL + url,\n      method: options.method || 'GET',\n      data: options.data || {},\n      header: headers,\n      success: (res) => {\n        // 处理响应中的cookie\n        if (res.header && res.header['Set-Cookie']) {\n          extractCookies(res.header['Set-Cookie'])\n        }\n        if (res.cookies && res.cookies.length > 0) {\n          res.cookies.forEach(cookie => {\n            if (cookie.name && cookie.value) {\n              storedCookies[cookie.name] = cookie.value\n            }\n          })\n        }\n        \n        if (res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(res.data)\n        } else {\n          // 处理401未授权\n          if (res.statusCode === 401) {\n            // 清除cookie\n            storedCookies = {}\n          }\n          reject(new Error(res.data?.error || `请求失败: ${res.statusCode}`))\n        }\n      },\n      fail: (err) => {\n        console.error('请求失败:', err)\n        reject(new Error(err.errMsg || '网络请求失败'))\n      }\n    })\n  })\n}\n\n// 清除所有cookie（用于登出）\nexport function clearCookies() {\n  storedCookies = {}\n}\n\n// 认证相关API\nexport const authAPI = {\n  // 微信登录\n  wechatLogin(code, userInfo) {\n    return request('/api/auth/wechat/login', {\n      method: 'POST',\n      data: { code, ...userInfo }\n    })\n  },\n  \n  // 邮箱登录（保留，可能不需要）\n  login(email, password) {\n    return request('/api/auth/login', {\n      method: 'POST',\n      data: { email, password }\n    })\n  },\n  \n  // 注册 - 请求验证码\n  requestCode(email, name, password) {\n    return request('/api/auth/register/request-code', {\n      method: 'POST',\n      data: { email, name, password }\n    })\n  },\n  \n  // 注册 - 验证验证码\n  verifyCode(email, code) {\n    return request('/api/auth/register/verify', {\n      method: 'POST',\n      data: { email, code }\n    })\n  },\n  \n  // 获取当前用户信息\n  getMe() {\n    return request('/api/auth/me')\n  },\n  \n  // 登出\n  async logout() {\n    try {\n      await request('/api/auth/logout', {\n        method: 'POST'\n      })\n    } finally {\n      // 清除本地cookie\n      clearCookies()\n    }\n  }\n}\n\n// 设计相关API\nexport const designAPI = {\n  // 获取所有设计\n  getDesigns() {\n    return request('/api/designs')\n  },\n  \n  // 获取单个设计\n  getDesign(id) {\n    return request(`/api/designs/${id}`)\n  },\n  \n  // 保存设计\n  saveDesign(designData) {\n    return request('/api/designs', {\n      method: 'POST',\n      data: designData\n    })\n  },\n  \n  // 更新设计\n  updateDesign(id, designData) {\n    return request(`/api/designs/${id}`, {\n      method: 'PUT',\n      data: designData\n    })\n  },\n  \n  // 删除设计\n  deleteDesign(id) {\n    return request(`/api/designs/${id}`, {\n      method: 'DELETE'\n    })\n  }\n}\n\n// 商品相关API\nexport const productAPI = {\n  // 获取Shopify商品列表\n  getProducts() {\n    return request('/api/shopify/products')\n  }\n}\n\nexport default {\n  request,\n  authAPI,\n  designAPI,\n  productAPI\n}\n"],"names":["uni"],"mappings":"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"}