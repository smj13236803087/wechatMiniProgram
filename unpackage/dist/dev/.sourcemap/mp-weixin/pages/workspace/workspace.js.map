{"version":3,"file":"workspace.js","sources":["pages/workspace/workspace.vue","pages/workspace/workspace.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"title\">工作台</view>\n\t\t\n\t\t<!-- 手腕尺寸设置弹窗 -->\n\t\t<view v-if=\"showWristSizeModal\" class=\"modal-overlay\" @click=\"closeModal\">\n\t\t\t<view class=\"modal-content\" @click.stop>\n\t\t\t\t<view class=\"modal-title\">设置手腕尺寸</view>\n\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t<view class=\"label\">手围（厘米）</view>\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype=\"digit\" \n\t\t\t\t\t\tv-model=\"wristSizeInput\" \n\t\t\t\t\t\tplaceholder=\"请输入手围\"\n\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t<view class=\"label\">佩戴方式</view>\n\t\t\t\t\t<view class=\"radio-group\">\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"radio-item\" \n\t\t\t\t\t\t\t:class=\"{ active: wearingStyle === 'single' }\"\n\t\t\t\t\t\t\t@click=\"wearingStyle = 'single'\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>单圈</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"radio-item\" \n\t\t\t\t\t\t\t:class=\"{ active: wearingStyle === 'double' }\"\n\t\t\t\t\t\t\t@click=\"wearingStyle = 'double'\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>双圈</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<button class=\"modal-btn\" @click=\"completeWristSize\">完成</button>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"workspace-content\">\n\t\t\t<!-- 上面：预览区域 -->\n\t\t\t<view class=\"preview-panel\">\n\t\t\t\t<view class=\"preview-header\">\n\t\t\t\t\t<view class=\"preview-title\">手串预览</view>\n\t\t\t\t\t<view class=\"wrist-info\" @click=\"showWristSizeModal = true\">\n\t\t\t\t\t\t<text class=\"wrist-label\">手围：{{ wristSize }}cm</text>\n\t\t\t\t\t\t<text class=\"wrist-style\">{{ wearingStyle === 'single' ? '单圈' : '双圈' }}</text>\n\t\t\t\t\t\t<text class=\"wrist-edit\">✏️</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- SVG 圆形预览 -->\n\t\t\t\t<view class=\"bracelet-preview-container\">\n\t\t\t\t\t<view v-if=\"items.length === 0\" class=\"empty-preview\">\n\t\t\t\t\t\t<text>从下方选择材料开始设计</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view v-else class=\"preview-svg-wrapper\">\n\t\t\t\t\t\t<!-- 提示信息 -->\n\t\t\t\t\t\t<view v-if=\"exceedsLimit\" class=\"preview-tip preview-tip-error\">\n\t\t\t\t\t\t\t已达到设定手围！当前周长：{{ currentCircumference.toFixed(1) }}cm，最大周长：{{ maxCircumference.toFixed(1) }}cm\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-else-if=\"reachesLimit\" class=\"preview-tip preview-tip-success\">\n\t\t\t\t\t\t\t已完美匹配设定手围！手串已自动调整为完美圆形\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view class=\"canvas-container\">\n\t\t\t\t\t\t\t<canvas \n\t\t\t\t\t\t\t\tcanvas-id=\"braceletCanvas\"\n\t\t\t\t\t\t\t\t:style=\"{ width: previewSizePx + 'px', height: previewSizePx + 'px' }\"\n\t\t\t\t\t\t\t\tclass=\"bracelet-canvas\"\n\t\t\t\t\t\t\t\t@touchstart=\"handleCanvasTouchStart\"\n\t\t\t\t\t\t\t\t@touchmove=\"handleCanvasTouchMove\"\n\t\t\t\t\t\t\t\t@touchend=\"handleCanvasTouchEnd\"\n\t\t\t\t\t\t\t></canvas>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- 项目列表（简化显示） -->\n\t\t\t\t\t\t<scroll-view class=\"items-list-mini\" scroll-y>\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tv-for=\"(item, index) in items\" \n\t\t\t\t\t\t\t\t:key=\"item.id\"\n\t\t\t\t\t\t\t\tclass=\"item-card-mini\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<view class=\"item-info-mini\">\n\t\t\t\t\t\t\t\t\t<text class=\"item-index-mini\">{{ index + 1 }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"item-name-mini\">{{ item.name }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"item-price-mini\">¥{{ item.price }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<button class=\"delete-btn-mini\" @click=\"removeItem(item.id)\">删除</button>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</scroll-view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<view class=\"preview-footer\">\n\t\t\t\t\t<view class=\"price-section\">\n\t\t\t\t\t\t<view class=\"price-info\">\n\t\t\t\t\t\t\t<text class=\"price-label\">总价：</text>\n\t\t\t\t\t\t\t<text class=\"price-value\">¥{{ totalPrice }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"price-info\">\n\t\t\t\t\t\t\t<text class=\"price-label\">项目数：</text>\n\t\t\t\t\t\t\t<text class=\"price-value\">{{ items.length }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"save-section\">\n\t\t\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t\t\t<view class=\"label\">作品名称</view>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\tv-model=\"designName\" \n\t\t\t\t\t\t\t\tplaceholder=\"给你的作品起个名字吧\"\n\t\t\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"save-btn\" \n\t\t\t\t\t\t\t:disabled=\"items.length === 0 || saving\"\n\t\t\t\t\t\t\t@click=\"saveDesign\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ saving ? '保存中...' : '保存到我的作品集' }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 下面：材料选择区域 -->\n\t\t\t<scroll-view class=\"config-panel\" scroll-y>\n\t\t\t\t<view v-if=\"loading\" class=\"loading-text\">正在加载商品...</view>\n\t\t\t\t<view v-else-if=\"error\" class=\"error-text\">加载失败：{{ error }}</view>\n\t\t\t\t<view v-else-if=\"!categorizedProducts\" class=\"loading-text\">暂无商品数据</view>\n\t\t\t\t<view v-else>\n\t\t\t\t\t<!-- 珠子 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-header\">\n\t\t\t\t\t\t\t<view class=\"section-title\">珠子</view>\n\t\t\t\t\t\t\t<view v-if=\"beadStep !== 'category'\" class=\"back-btn\" @click=\"resetBeadSelection\">\n\t\t\t\t\t\t\t\t<text>← 返回</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-if=\"beadStep === 'category'\">\n\t\t\t\t\t\t\t<view class=\"category-grid\" v-if=\"categorizedProducts && validBeadCategories.length > 0\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validBeadCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"category-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectBeadCategory(category.key)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getCategoryImage(category.key)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"category-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"category-name\">{{ categorizedProducts[category.key]?.name || '' }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t\t<view class=\"section-subtitle\" v-if=\"selectedBeadCategory && categorizedProducts && categorizedProducts[selectedBeadCategory]\">\n\t\t\t\t\t\t\t\t选择 {{ categorizedProducts[selectedBeadCategory]?.name || '' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"product-grid\" v-if=\"selectedBeadCategory && categorizedProducts && categorizedProducts[selectedBeadCategory] && categorizedProducts[selectedBeadCategory].products\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[selectedBeadCategory].products\"\n\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectBeadProduct(product)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 配饰 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-header\">\n\t\t\t\t\t\t\t<view class=\"section-title\">配饰</view>\n\t\t\t\t\t\t\t<view v-if=\"accessoryStep !== 'category'\" class=\"back-btn\" @click=\"resetAccessorySelection\">\n\t\t\t\t\t\t\t\t<text>← 返回</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-if=\"accessoryStep === 'category'\">\n\t\t\t\t\t\t\t<view class=\"category-grid\" v-if=\"categorizedProducts && validAccessoryCategories.length > 0\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validAccessoryCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"category-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectAccessoryCategory(category.key)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getCategoryImage(category.key)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"category-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"category-name\">{{ categorizedProducts[category.key]?.name || '' }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t\t<view class=\"section-subtitle\" v-if=\"selectedAccessoryCategory && categorizedProducts && categorizedProducts[selectedAccessoryCategory]\">\n\t\t\t\t\t\t\t\t选择 {{ categorizedProducts[selectedAccessoryCategory]?.name || '' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"product-grid\" v-if=\"selectedAccessoryCategory && categorizedProducts && categorizedProducts[selectedAccessoryCategory] && categorizedProducts[selectedAccessoryCategory].products\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[selectedAccessoryCategory].products\"\n\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectAccessoryProduct(product)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 吊坠 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-title\">吊坠</view>\n\t\t\t\t\t\t<view v-if=\"!categorizedProducts || !categorizedProducts.pendant || !categorizedProducts.pendant.products || categorizedProducts.pendant.products.length === 0\" class=\"empty-text\">\n\t\t\t\t\t\t\t暂无吊坠商品\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-else class=\"product-grid\">\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts.pendant.products\"\n\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t@click=\"selectPendantProduct(product)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { productAPI, designAPI } from '@/utils/api.js'\n\timport { \n\t\tcategorizeProducts, \n\t\tgetProductImage, \n\t\tgetProductPrice, \n\t\tgetProductDiameter, \n\t\tgetProductWeight,\n\t\tparseDiameter,\n\t\tparseWeight,\n\t\tcalculateTotalPrice,\n\t\tgenerateId\n\t} from '@/utils/bracelet.js'\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading: true,\n\t\t\t\terror: null,\n\t\t\t\tcategorizedProducts: null,\n\t\t\t\titems: [],\n\t\t\t\tshowWristSizeModal: false, // 默认不显示，因为已经有默认值\n\t\t\t\twristSize: 16, // 默认手围16\n\t\t\t\twristSizeInput: '16',\n\t\t\t\twearingStyle: 'single', // 默认单圈\n\t\t\t\tdesignName: '',\n\t\t\t\tcurrentDesignId: null,\n\t\t\t\tsaving: false,\n\t\t\t\tcanvasCtx: null, // Canvas 上下文\n\t\t\t\t// 珠子选择状态\n\t\t\t\tbeadStep: 'category',\n\t\t\t\tselectedBeadCategory: null,\n\t\t\t\t// 配饰选择状态\n\t\t\t\taccessoryStep: 'category',\n\t\t\t\tselectedAccessoryCategory: null,\n\t\t\t\t// 分类映射\n\t\t\t\tbeadCategories: [\n\t\t\t\t\t{ key: 'obsidian', category: 'obsidian' },\n\t\t\t\t\t{ key: 'amethyst', category: 'amethyst' },\n\t\t\t\t\t{ key: 'moonshine', category: 'moonstone' }\n\t\t\t\t],\n\t\t\t\taccessoryCategories: [\n\t\t\t\t\t{ key: 'cutoff', category: 'spacer' },\n\t\t\t\t\t{ key: 'running-laps', category: 'decoration' },\n\t\t\t\t\t{ key: 'double-pointed-crystal', category: 'doubleTerminated' }\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\ttotalPrice() {\n\t\t\t\treturn calculateTotalPrice(this.items)\n\t\t\t},\n\t\t\t// 过滤有效的珠子分类\n\t\t\tvalidBeadCategories() {\n\t\t\t\tif (!this.categorizedProducts) return []\n\t\t\t\treturn this.beadCategories.filter(category => {\n\t\t\t\t\treturn category && \n\t\t\t\t\t\tcategory.key && \n\t\t\t\t\t\tthis.categorizedProducts[category.key] && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products.length > 0\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 过滤有效的配饰分类\n\t\t\tvalidAccessoryCategories() {\n\t\t\t\tif (!this.categorizedProducts) return []\n\t\t\t\treturn this.accessoryCategories.filter(category => {\n\t\t\t\t\treturn category && \n\t\t\t\t\t\tcategory.key && \n\t\t\t\t\t\tthis.categorizedProducts[category.key] && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products.length > 0\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 预览尺寸（像素）- 用于计算\n\t\t\tpreviewSize() {\n\t\t\t\t// 在小程序中，canvas 使用像素单位，这里使用 600rpx 对应的像素值\n\t\t\t\t// 根据设备像素比，通常 1rpx = 0.5px（在 750rpx 设计稿下）\n\t\t\t\t// 但 canvas 内部使用绝对像素，这里使用固定值 300px 确保显示正常\n\t\t\t\treturn 300\n\t\t\t},\n\t\t\t// 预览尺寸（像素）- 用于样式（rpx转px）\n\t\t\tpreviewSizePx() {\n\t\t\t\t// 获取系统信息，计算实际像素值\n\t\t\t\tconst systemInfo = uni.getSystemInfoSync()\n\t\t\t\tconst screenWidth = systemInfo.screenWidth\n\t\t\t\t// 750rpx 设计稿标准，600rpx 对应的像素值\n\t\t\t\treturn (600 / 750) * screenWidth\n\t\t\t},\n\t\t\t// 中心点坐标\n\t\t\tcenterX() {\n\t\t\t\treturn this.previewSize / 2\n\t\t\t},\n\t\t\tcenterY() {\n\t\t\t\treturn this.previewSize / 2\n\t\t\t},\n\t\t\t// 基础半径\n\t\t\tradius() {\n\t\t\t\treturn this.previewSize * 0.3\n\t\t\t},\n\t\t\t// 默认直径（毫米）\n\t\t\tdefaultDiameter() {\n\t\t\t\treturn 8\n\t\t\t},\n\t\t\t// 毫米转像素比例\n\t\t\tmmToPx() {\n\t\t\t\treturn 2.5\n\t\t\t},\n\t\t\t// 最大和最小缩放因子\n\t\t\tmaxPreferredScale() {\n\t\t\t\treturn 2.0\n\t\t\t},\n\t\t\tminPreferredScale() {\n\t\t\t\treturn 0.25\n\t\t\t},\n\t\t\t// 计算当前周长（厘米）\n\t\t\tcurrentCircumference() {\n\t\t\t\tconst totalDiameterMm = this.items.reduce((sum, item) => {\n\t\t\t\t\treturn sum + (item.diameter || this.defaultDiameter)\n\t\t\t\t}, 0)\n\t\t\t\treturn totalDiameterMm / 10 // 毫米转厘米\n\t\t\t},\n\t\t\t// 计算最大周长\n\t\t\tmaxCircumference() {\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) return null\n\t\t\t\treturn this.wearingStyle === 'single' ? this.wristSize * 1.1 : this.wristSize * 2.2\n\t\t\t},\n\t\t\t// 是否达到设定手围\n\t\t\treachesLimit() {\n\t\t\t\tif (!this.maxCircumference || this.items.length === 0) return false\n\t\t\t\treturn this.currentCircumference >= this.maxCircumference * 0.95\n\t\t\t},\n\t\t\t// 是否超过设定手围\n\t\t\texceedsLimit() {\n\t\t\t\treturn this.maxCircumference !== null && this.currentCircumference > this.maxCircumference\n\t\t\t},\n\t\t\t// 计算珠子大小的缩放因子\n\t\t\tbeadScale() {\n\t\t\t\tif (this.items.length === 0) return this.maxPreferredScale\n\n\t\t\t\tconst target = 2 * Math.PI\n\n\t\t\t\tconst totalAngleForScale = (scale) => {\n\t\t\t\t\tlet total = 0\n\t\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\t\tconst a = this.items[i]\n\t\t\t\t\t\tconst b = this.items[(i + 1) % this.items.length]\n\t\t\t\t\t\tconst d1 = a.diameter ?? this.defaultDiameter\n\t\t\t\t\t\tconst d2 = b.diameter ?? this.defaultDiameter\n\t\t\t\t\t\tconst r1 = (d1 / 2) * this.mmToPx * scale\n\t\t\t\t\t\tconst r2 = (d2 / 2) * this.mmToPx * scale\n\t\t\t\t\t\tconst combined = r1 + r2\n\t\t\t\t\t\tconst safeRatio = Math.min(combined / (2 * this.radius), 0.999)\n\t\t\t\t\t\ttotal += 2 * Math.asin(safeRatio)\n\t\t\t\t\t}\n\t\t\t\t\treturn total\n\t\t\t\t}\n\n\t\t\t\tconst maxScale = this.maxPreferredScale\n\t\t\t\tconst minScale = this.minPreferredScale\n\n\t\t\t\tconst totalAtMax = totalAngleForScale(maxScale)\n\t\t\t\tif (Math.abs(totalAtMax - target) < 1e-4) return maxScale\n\t\t\t\tif (totalAtMax < target) {\n\t\t\t\t\treturn maxScale\n\t\t\t\t}\n\n\t\t\t\tconst totalAtMin = totalAngleForScale(minScale)\n\t\t\t\tif (totalAtMin > target) {\n\t\t\t\t\treturn minScale\n\t\t\t\t}\n\n\t\t\t\t// 二分查找\n\t\t\t\tlet lo = minScale\n\t\t\t\tlet hi = maxScale\n\t\t\t\tlet best = minScale\n\t\t\t\tfor (let iter = 0; iter < 50; iter++) {\n\t\t\t\t\tconst mid = (lo + hi) / 2\n\t\t\t\t\tconst t = totalAngleForScale(mid)\n\t\t\t\t\tif (Math.abs(t - target) < 1e-4) {\n\t\t\t\t\t\tbest = mid\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif (t > target) {\n\t\t\t\t\t\thi = mid\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlo = mid\n\t\t\t\t\t\tbest = mid\n\t\t\t\t\t}\n\t\t\t\t\tif (hi - lo < 1e-4) break\n\t\t\t\t}\n\n\t\t\t\treturn best\n\t\t\t},\n\t\t\t// 计算角度间隔\n\t\t\tangleSteps() {\n\t\t\t\tif (this.items.length === 0) return []\n\t\t\t\t\n\t\t\t\tconst steps = []\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\tconst currentItem = this.items[i]\n\t\t\t\t\tconst nextItem = this.items[(i + 1) % this.items.length]\n\t\t\t\t\t\n\t\t\t\t\tconst radius1 = this.getBeadRadius(currentItem.diameter)\n\t\t\t\t\tconst radius2 = this.getBeadRadius(nextItem.diameter)\n\t\t\t\t\tconst combinedRadius = radius1 + radius2\n\t\t\t\t\tconst safeRatio = Math.min(combinedRadius / (2 * this.radius), 0.999)\n\t\t\t\t\tconst angleStep = 2 * Math.asin(safeRatio)\n\t\t\t\t\tsteps.push(angleStep)\n\t\t\t\t}\n\t\t\t\treturn steps\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tif (options.designId) {\n\t\t\t\tthis.loadDesign(options.designId)\n\t\t\t}\n\t\t\tthis.fetchProducts()\n\t\t\t// 延迟初始化 canvas，确保 DOM 已渲染\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.initCanvas()\n\t\t\t\t}, 500)\n\t\t\t})\n\t\t},\n\t\twatch: {\n\t\t\titems: {\n\t\t\t\thandler() {\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tdeep: true\n\t\t\t},\n\t\t\twristSize() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t})\n\t\t\t},\n\t\t\twearingStyle() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tasync fetchProducts() {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.error = null\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await productAPI.getProducts()\n\t\t\t\t\t// 处理返回的数据结构\n\t\t\t\t\tconst products = res.products || res || []\n\t\t\t\t\tif (!Array.isArray(products)) {\n\t\t\t\t\t\tthrow new Error('商品数据格式不正确')\n\t\t\t\t\t}\n\t\t\t\t\tthis.categorizedProducts = categorizeProducts(products)\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthis.error = err.message || '拉取商品失败'\n\t\t\t\t\tconsole.error('拉取商品失败：', err)\n\t\t\t\t\tthis.categorizedProducts = null\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tasync loadDesign(id) {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await designAPI.getDesign(id)\n\t\t\t\t\tconst design = res.design\n\t\t\t\t\tif (design) {\n\t\t\t\t\t\tthis.items = design.items || []\n\t\t\t\t\t\tthis.wristSize = design.wristSize || 16\n\t\t\t\t\t\tthis.wristSizeInput = String(this.wristSize)\n\t\t\t\t\t\tthis.wearingStyle = design.wearingStyle || 'single'\n\t\t\t\t\t\tthis.showWristSizeModal = false\n\t\t\t\t\t\tthis.designName = design.name || ''\n\t\t\t\t\t\tthis.currentDesignId = design.id\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('加载作品失败：', err)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '加载作品失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tgetCategoryImage(categoryKey) {\n\t\t\t\tif (!this.categorizedProducts || !categoryKey || !this.categorizedProducts[categoryKey]) {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t\tconst products = this.categorizedProducts[categoryKey]?.products\n\t\t\t\tif (products && products.length > 0) {\n\t\t\t\t\treturn getProductImage(products[0])\n\t\t\t\t}\n\t\t\t\treturn ''\n\t\t\t},\n\t\t\t\n\t\t\tgetProductImage,\n\t\t\tgetProductPrice,\n\t\t\t\n\t\t\tcheckWristSizeLimit(newDiameter) {\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) return true\n\t\t\t\t\n\t\t\t\tconst maxCircumference = this.wearingStyle === 'single' \n\t\t\t\t\t? this.wristSize * 1.1 \n\t\t\t\t\t: this.wristSize * 2.2\n\t\t\t\tconst defaultDiameter = 8\n\t\t\t\tconst currentTotalDiameterMm = this.items.reduce((sum, item) => {\n\t\t\t\t\treturn sum + (item.diameter || defaultDiameter)\n\t\t\t\t}, 0)\n\t\t\t\tconst newTotalDiameterMm = currentTotalDiameterMm + (newDiameter || defaultDiameter)\n\t\t\t\tconst newCircumference = newTotalDiameterMm / 10\n\t\t\t\t\n\t\t\t\treturn newCircumference <= maxCircumference\n\t\t\t},\n\t\t\t\n\t\t\tselectBeadCategory(categoryKey) {\n\t\t\t\tthis.selectedBeadCategory = categoryKey\n\t\t\t\tthis.beadStep = 'product'\n\t\t\t},\n\t\t\t\n\t\t\tresetBeadSelection() {\n\t\t\t\tthis.beadStep = 'category'\n\t\t\t\tthis.selectedBeadCategory = null\n\t\t\t},\n\t\t\t\n\t\t\tselectBeadProduct(product) {\n\t\t\t\tif (!this.selectedBeadCategory) return\n\t\t\t\t\n\t\t\t\tconst category = this.beadCategories.find(c => c && c.key === this.selectedBeadCategory)\n\t\t\t\tif (!category || !category.category) return\n\t\t\t\t\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多珠子。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'bead',\n\t\t\t\t\tbeadCategory: category.category,\n\t\t\t\t\tbeadSubType: product.title,\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t\tthis.resetBeadSelection()\n\t\t\t},\n\t\t\t\n\t\t\tselectAccessoryCategory(categoryKey) {\n\t\t\t\tthis.selectedAccessoryCategory = categoryKey\n\t\t\t\tthis.accessoryStep = 'product'\n\t\t\t},\n\t\t\t\n\t\t\tresetAccessorySelection() {\n\t\t\t\tthis.accessoryStep = 'category'\n\t\t\t\tthis.selectedAccessoryCategory = null\n\t\t\t},\n\t\t\t\n\t\t\tselectAccessoryProduct(product) {\n\t\t\t\tif (!this.selectedAccessoryCategory) return\n\t\t\t\t\n\t\t\t\tconst category = this.accessoryCategories.find(c => c && c.key === this.selectedAccessoryCategory)\n\t\t\t\tif (!category || !category.category) return\n\t\t\t\t\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多配饰。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'accessory',\n\t\t\t\t\taccessoryCategory: category.category,\n\t\t\t\t\taccessorySubType: product.title,\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t\tthis.resetAccessorySelection()\n\t\t\t},\n\t\t\t\n\t\t\tselectPendantProduct(product) {\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多吊坠。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'pendant',\n\t\t\t\t\tpendantType: 'pendant',\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t},\n\t\t\t\n\t\t\tremoveItem(id) {\n\t\t\t\tthis.items = this.items.filter(item => item.id !== id)\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子半径（像素）\n\t\t\tgetBeadRadius(diameter) {\n\t\t\t\tconst diameterMm = diameter || this.defaultDiameter\n\t\t\t\treturn (diameterMm / 2) * this.mmToPx * this.beadScale\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的角度位置\n\t\t\tgetItemAngle(index) {\n\t\t\t\tif (index === 0) return 0\n\t\t\t\t\n\t\t\t\tlet cumulativeAngle = 0\n\t\t\t\tfor (let i = 0; i < index; i++) {\n\t\t\t\t\tcumulativeAngle += this.angleSteps[i]\n\t\t\t\t}\n\t\t\t\treturn cumulativeAngle\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的 X 坐标\n\t\t\tgetItemX(index) {\n\t\t\t\tconst angle = this.getItemAngle(index)\n\t\t\t\treturn this.centerX + this.radius * Math.cos(angle)\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的 Y 坐标\n\t\t\tgetItemY(index) {\n\t\t\t\tconst angle = this.getItemAngle(index)\n\t\t\t\treturn this.centerY + this.radius * Math.sin(angle)\n\t\t\t},\n\t\t\t\n\t\t\t// 初始化 canvas\n\t\t\tinitCanvas() {\n\t\t\t\t// 使用 uni.createCanvasContext 创建 canvas 上下文（适用于微信小程序）\n\t\t\t\tthis.canvasCtx = uni.createCanvasContext('braceletCanvas', this)\n\t\t\t\t// 延迟绘制，确保 canvas 已渲染\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t}, 100)\n\t\t\t},\n\t\t\t\n\t\t\t// 绘制手串\n\t\t\tdrawBracelet() {\n\t\t\t\tif (!this.canvasCtx) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst ctx = this.canvasCtx\n\t\t\t\tconst size = this.previewSize\n\t\t\t\t\n\t\t\t\t// 清空画布\n\t\t\t\tctx.clearRect(0, 0, size, size)\n\t\t\t\t\n\t\t\t\tif (this.items.length === 0) {\n\t\t\t\t\tctx.draw()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 绘制圆形路径（虚线）\n\t\t\t\tctx.beginPath()\n\t\t\t\tctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI)\n\t\t\t\tctx.setStrokeStyle('#e5e7eb')\n\t\t\t\tctx.setLineWidth(2)\n\t\t\t\t// 小程序中虚线使用 setLineDash\n\t\t\t\tctx.setLineDash([5, 5], 0)\n\t\t\t\tctx.stroke()\n\t\t\t\tctx.setLineDash([], 0)\n\t\t\t\t\n\t\t\t\t// 绘制每个珠子\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\tconst item = this.items[i]\n\t\t\t\t\tconst x = this.getItemX(i)\n\t\t\t\t\tconst y = this.getItemY(i)\n\t\t\t\t\tconst radius = this.getBeadRadius(item.diameter)\n\t\t\t\t\tconst color = item.color || '#8b4513'\n\t\t\t\t\t\n\t\t\t\t\t// 绘制珠子\n\t\t\t\t\tctx.beginPath()\n\t\t\t\t\tctx.arc(x, y, radius, 0, 2 * Math.PI)\n\t\t\t\t\tctx.setFillStyle(color)\n\t\t\t\t\tctx.fill()\n\t\t\t\t\t\n\t\t\t\t\t// 绘制白色边框\n\t\t\t\t\tctx.setStrokeStyle('#ffffff')\n\t\t\t\t\tctx.setLineWidth(2)\n\t\t\t\t\tctx.stroke()\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 绘制到画布\n\t\t\t\tctx.draw()\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸开始\n\t\t\thandleCanvasTouchStart(e) {\n\t\t\t\t// 拖拽功能可以后续完善\n\t\t\t\tconsole.log('Canvas touch start', e)\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸移动\n\t\t\thandleCanvasTouchMove(e) {\n\t\t\t\t// 拖拽功能可以后续完善\n\t\t\t\tconsole.log('Canvas touch move', e)\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸结束\n\t\t\thandleCanvasTouchEnd(e) {\n\t\t\t\t// 拖拽功能可以后续完善\n\t\t\t\tconsole.log('Canvas touch end', e)\n\t\t\t},\n\t\t\t\n\t\t\tcompleteWristSize() {\n\t\t\t\tconst size = parseFloat(this.wristSizeInput)\n\t\t\t\tif (!size || size <= 0) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入有效的手围',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.wearingStyle) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请选择佩戴方式',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.wristSize = size\n\t\t\t\tthis.showWristSizeModal = false\n\t\t\t},\n\t\t\t\n\t\t\tcloseModal() {\n\t\t\t\t// 允许关闭，因为有默认值\n\t\t\t\tthis.showWristSizeModal = false\n\t\t\t},\n\t\t\t\n\t\t\tasync saveDesign() {\n\t\t\t\tif (!this.items.length) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先设计手串再保存～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先完成手腕尺寸设置～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tthis.showWristSizeModal = true\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst trimmed = this.designName.trim()\n\t\t\t\tif (!trimmed) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先输入作品名称',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.saving = true\n\t\t\t\ttry {\n\t\t\t\t\tconst totalWeight = this.items.reduce((sum, item) => sum + (item.weight || 0), 0)\n\t\t\t\t\tconst diameters = this.items.map(i => i.diameter).filter(d => !!d)\n\t\t\t\t\tconst averageDiameter = diameters.length > 0\n\t\t\t\t\t\t? diameters.reduce((a, b) => a + b, 0) / diameters.length\n\t\t\t\t\t\t: null\n\t\t\t\t\t\n\t\t\t\t\tconst designData = {\n\t\t\t\t\t\tid: this.currentDesignId || undefined,\n\t\t\t\t\t\tname: trimmed,\n\t\t\t\t\t\titems: this.items,\n\t\t\t\t\t\ttotalPrice: this.totalPrice,\n\t\t\t\t\t\ttotalWeight: totalWeight,\n\t\t\t\t\t\taverageDiameter: averageDiameter,\n\t\t\t\t\t\twristSize: this.wristSize,\n\t\t\t\t\t\twearingStyle: this.wearingStyle\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst res = await designAPI.saveDesign(designData)\n\t\t\t\t\tthis.currentDesignId = res.design.id\n\t\t\t\t\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '保存成功',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\t\turl: '/pages/portfolio/portfolio'\n\t\t\t\t\t\t})\n\t\t\t\t\t}, 1500)\n\t\t\t\t} catch (err) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: err.message || '保存失败，请稍后重试',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.saving = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.container {\n\t\tmin-height: 100vh;\n\t\tbackground: #f3f4f6;\n\t\tpadding: 20rpx;\n\t}\n\t\n\t.title {\n\t\tfont-size: 48rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.modal-overlay {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tz-index: 1000;\n\t}\n\t\n\t.modal-content {\n\t\tbackground: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 60rpx 40rpx;\n\t\twidth: 80%;\n\t\tmax-width: 600rpx;\n\t}\n\t\n\t.modal-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t\tmargin-bottom: 40rpx;\n\t\ttext-align: center;\n\t}\n\t\n\t.form-item {\n\t\tmargin-bottom: 40rpx;\n\t}\n\t\n\t.label {\n\t\tfont-size: 28rpx;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 16rpx;\n\t\tdisplay: block;\n\t}\n\t\n\t.input {\n\t\twidth: 100%;\n\t\theight: 88rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 0 24rpx;\n\t\tfont-size: 28rpx;\n\t\tbackground: #ffffff;\n\t}\n\t\n\t.radio-group {\n\t\tdisplay: flex;\n\t\tgap: 20rpx;\n\t}\n\t\n\t.radio-item {\n\t\tflex: 1;\n\t\tpadding: 24rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\ttext-align: center;\n\t\tfont-size: 28rpx;\n\t\tcolor: #6b7280;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.radio-item.active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t}\n\t\n\t.modal-btn {\n\t\twidth: 100%;\n\t\theight: 96rpx;\n\t\tbackground: linear-gradient(135deg, #3b82f6, #8b5cf6);\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 600;\n\t\tborder-radius: 16rpx;\n\t\tborder: none;\n\t}\n\t\n\t.workspace-content {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 20rpx;\n\t}\n\t\n\t.preview-panel {\n\t\tbackground: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 30rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-shrink: 0;\n\t}\n\t\n\t.preview-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24rpx;\n\t\tpadding-bottom: 20rpx;\n\t\tborder-bottom: 2rpx solid #f3f4f6;\n\t}\n\t\n\t.preview-title {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t}\n\t\n\t.wrist-info {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12rpx;\n\t\tpadding: 12rpx 20rpx;\n\t\tbackground: #f3f4f6;\n\t\tborder-radius: 20rpx;\n\t\tfont-size: 24rpx;\n\t}\n\t\n\t.wrist-label {\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.wrist-style {\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t}\n\t\n\t.wrist-edit {\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.config-panel {\n\t\tflex: 1;\n\t\tbackground: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 30rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n\t}\n\t\n\t.loading-text, .error-text, .empty-text {\n\t\ttext-align: center;\n\t\tpadding: 60rpx 0;\n\t\tfont-size: 28rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.error-text {\n\t\tcolor: #dc2626;\n\t}\n\t\n\t.section {\n\t\tmargin-bottom: 60rpx;\n\t}\n\t\n\t.section-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 30rpx;\n\t}\n\t\n\t.section-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t}\n\t\n\t.back-btn {\n\t\tfont-size: 26rpx;\n\t\tcolor: #3b82f6;\n\t}\n\t\n\t.section-subtitle {\n\t\tfont-size: 26rpx;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 24rpx;\n\t}\n\t\n\t.category-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr);\n\t\tgap: 20rpx;\n\t}\n\t\n\t.category-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 30rpx 20rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.category-item:active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t}\n\t\n\t.category-image {\n\t\twidth: 120rpx;\n\t\theight: 120rpx;\n\t\tborder-radius: 50%;\n\t\tmargin-bottom: 16rpx;\n\t\tbackground: #f3f4f6;\n\t}\n\t\n\t.category-name {\n\t\tfont-size: 26rpx;\n\t\tfont-weight: 500;\n\t\tcolor: #374151;\n\t\ttext-align: center;\n\t}\n\t\n\t.product-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(2, 1fr);\n\t\tgap: 20rpx;\n\t}\n\t\n\t.product-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 24rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.product-item:active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t}\n\t\n\t.product-image {\n\t\twidth: 160rpx;\n\t\theight: 160rpx;\n\t\tborder-radius: 16rpx;\n\t\tmargin-bottom: 16rpx;\n\t\tbackground: #f3f4f6;\n\t}\n\t\n\t.product-name {\n\t\tfont-size: 24rpx;\n\t\tfont-weight: 500;\n\t\tcolor: #374151;\n\t\ttext-align: center;\n\t\tmargin-bottom: 8rpx;\n\t}\n\t\n\t.product-price {\n\t\tfont-size: 24rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.bracelet-preview-container {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmargin-bottom: 24rpx;\n\t}\n\t\n\t.preview-svg-wrapper {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t}\n\t\n\t.preview-tip {\n\t\twidth: 100%;\n\t\tpadding: 20rpx;\n\t\tborder-radius: 16rpx;\n\t\tmargin-bottom: 24rpx;\n\t\tfont-size: 24rpx;\n\t\ttext-align: center;\n\t}\n\t\n\t.preview-tip-error {\n\t\tbackground: #fef2f2;\n\t\tborder: 2rpx solid #fecaca;\n\t\tcolor: #dc2626;\n\t}\n\t\n\t.preview-tip-success {\n\t\tbackground: #f0fdf4;\n\t\tborder: 2rpx solid #bbf7d0;\n\t\tcolor: #16a34a;\n\t}\n\t\n\t.canvas-container {\n\t\twidth: 600rpx;\n\t\theight: 600rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin-bottom: 24rpx;\n\t\tbackground: #ffffff;\n\t\tborder-radius: 16rpx;\n\t\toverflow: hidden;\n\t}\n\t\n\t.bracelet-canvas {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: block;\n\t}\n\t\n\t.bead-circle {\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.items-list-mini {\n\t\twidth: 100%;\n\t\tmax-height: 300rpx;\n\t\tmargin-top: 24rpx;\n\t}\n\t\n\t.item-card-mini {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 16rpx 20rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 12rpx;\n\t\tmargin-bottom: 12rpx;\n\t}\n\t\n\t.item-info-mini {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12rpx;\n\t}\n\t\n\t.item-index-mini {\n\t\twidth: 40rpx;\n\t\theight: 40rpx;\n\t\tbackground: #3b82f6;\n\t\tcolor: #ffffff;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 22rpx;\n\t\tfont-weight: 600;\n\t\tflex-shrink: 0;\n\t}\n\t\n\t.item-name-mini {\n\t\tflex: 1;\n\t\tfont-size: 26rpx;\n\t\tcolor: #1f2937;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\t\n\t.item-price-mini {\n\t\tfont-size: 26rpx;\n\t\tfont-weight: 600;\n\t\tcolor: #3b82f6;\n\t\tmargin-left: 12rpx;\n\t}\n\t\n\t.delete-btn-mini {\n\t\tpadding: 8rpx 16rpx;\n\t\tbackground: #fef2f2;\n\t\tcolor: #dc2626;\n\t\tborder-radius: 8rpx;\n\t\tfont-size: 22rpx;\n\t\tborder: none;\n\t}\n\t\n\t.preview-footer {\n\t\tborder-top: 2rpx solid #f3f4f6;\n\t\tpadding-top: 24rpx;\n\t}\n\t\n\t.empty-preview {\n\t\ttext-align: center;\n\t\tpadding: 120rpx 0;\n\t\tfont-size: 26rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t\n\t.price-section {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24rpx;\n\t\tpadding: 20rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 16rpx;\n\t}\n\t\n\t.price-info {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tgap: 8rpx;\n\t}\n\t\n\t.price-label {\n\t\tfont-size: 24rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.price-value {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #3b82f6;\n\t}\n\t\n\t.save-section {\n\t\tmargin-top: 24rpx;\n\t}\n\t\n\t.save-btn {\n\t\twidth: 100%;\n\t\theight: 96rpx;\n\t\tbackground: linear-gradient(135deg, #8b5cf6, #ec4899);\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 600;\n\t\tborder-radius: 16rpx;\n\t\tborder: none;\n\t\tmargin-top: 20rpx;\n\t}\n\t\n\t.save-btn[disabled] {\n\t\topacity: 0.5;\n\t}\n</style>\n","import MiniProgramPage from '/Users/shaomaojia/Documents/HBuilderProjects/bracelet/pages/workspace/workspace.vue'\nwx.createPage(MiniProgramPage)"],"names":["calculateTotalPrice","uni","productAPI","categorizeProducts","designAPI","getProductImage","getProductPrice","getProductDiameter","getProductWeight","parseDiameter","parseWeight","generateId"],"mappings":"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"}