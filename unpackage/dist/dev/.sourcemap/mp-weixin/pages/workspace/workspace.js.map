{"version":3,"file":"workspace.js","sources":["pages/workspace/workspace.vue","pages/workspace/workspace.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 手腕尺寸设置弹窗 -->\n\t\t<view v-if=\"showWristSizeModal\" class=\"modal-overlay\" @click=\"closeModal\">\n\t\t\t<view class=\"modal-content\" @click.stop>\n\t\t\t\t<view class=\"modal-title\">设置手腕尺寸</view>\n\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t<view class=\"label\">手围（厘米）</view>\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype=\"digit\" \n\t\t\t\t\t\tv-model=\"wristSizeInput\" \n\t\t\t\t\t\tplaceholder=\"请输入手围\"\n\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t<view class=\"label\">佩戴方式</view>\n\t\t\t\t\t<view class=\"radio-group\">\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"radio-item\" \n\t\t\t\t\t\t\t:class=\"{ active: wearingStyle === 'single' }\"\n\t\t\t\t\t\t\t@click=\"wearingStyle = 'single'\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>单圈</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"radio-item\" \n\t\t\t\t\t\t\t:class=\"{ active: wearingStyle === 'double' }\"\n\t\t\t\t\t\t\t@click=\"wearingStyle = 'double'\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>双圈</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<button class=\"modal-btn\" @click=\"completeWristSize\">完成</button>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"workspace-content\">\n\t\t\t<!-- 固定顶部：预览区域 -->\n\t\t\t<view class=\"preview-panel-fixed\">\n\t\t\t\t<!-- 预览和右侧信息并排 -->\n\t\t\t\t<view class=\"preview-content-row\">\n\t\t\t\t\t<!-- Canvas 圆形预览 -->\n\t\t\t\t\t<view class=\"bracelet-preview-container\">\n\t\t\t\t\t\t<view v-if=\"items.length === 0\" class=\"empty-preview\">\n\t\t\t\t\t\t\t<text>从下方选择材料开始设计</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-else class=\"preview-svg-wrapper\">\n\t\t\t\t\t\t\t<!-- 提示信息 -->\n\t\t\t\t\t\t\t<view v-if=\"exceedsLimit\" class=\"preview-tip preview-tip-error\">\n\t\t\t\t\t\t\t\t已达到设定手围！当前周长：{{ currentCircumference.toFixed(1) }}cm，最大周长：{{ maxCircumference.toFixed(1) }}cm\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view v-else-if=\"reachesLimit\" class=\"preview-tip preview-tip-success\">\n\t\t\t\t\t\t\t\t已完美匹配设定手围！手串已自动调整为完美圆形\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<view class=\"canvas-container\" @touchmove.prevent.stop>\n\t\t\t\t\t\t\t\t<canvas \n\t\t\t\t\t\t\t\t\tcanvas-id=\"braceletCanvas\"\n\t\t\t\t\t\t\t\t\t:style=\"{ width: previewSizePx + 'px', height: previewSizePx + 'px' }\"\n\t\t\t\t\t\t\t\t\tclass=\"bracelet-canvas\"\n\t\t\t\t\t\t\t\t\t@touchstart.stop=\"handleCanvasTouchStart\"\n\t\t\t\t\t\t\t\t\t@touchmove.stop.prevent=\"handleCanvasTouchMove\"\n\t\t\t\t\t\t\t\t\t@touchend.stop=\"handleCanvasTouchEnd\"\n\t\t\t\t\t\t\t\t></canvas>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 右侧信息（手围、价格等） -->\n\t\t\t\t\t<view class=\"info-section-right\">\n\t\t\t\t\t\t<view class=\"wrist-info\">\n\t\t\t\t\t\t\t<text class=\"wrist-label\">手围：{{ wristSize }}cm</text>\n\t\t\t\t\t\t\t<text class=\"wrist-style\">{{ wearingStyle === 'single' ? '单圈' : '双圈' }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"price-info\">\n\t\t\t\t\t\t\t<text class=\"price-label\">总价：</text>\n\t\t\t\t\t\t\t<text class=\"price-value\">¥{{ totalPrice }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"price-info\">\n\t\t\t\t\t\t\t<text class=\"price-label\">项目数：</text>\n\t\t\t\t\t\t\t<text class=\"price-value\">{{ items.length }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 删除区域 -->\n\t\t\t\t<view \n\t\t\t\t\tclass=\"delete-zone\"\n\t\t\t\t\t:class=\"{ 'delete-zone-active': dragState.isDragging && dragState.isOverDeleteZone }\"\n\t\t\t\t>\n\t\t\t\t\t<text class=\"delete-zone-text\">拖到此处删除</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 材料选择区域（占屏幕三分之二高度） -->\n\t\t\t<view class=\"material-panel\">\n\t\t\t\t<!-- 顶部主tab -->\n\t\t\t\t<view class=\"main-tabs\">\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"main-tab-item\"\n\t\t\t\t\t\t:class=\"{ 'active': activeMainTab === 'bead' }\"\n\t\t\t\t\t\t@click=\"activeMainTab = 'bead'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t珠子\n\t\t\t\t\t</view>\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"main-tab-item\"\n\t\t\t\t\t\t:class=\"{ 'active': activeMainTab === 'accessory' }\"\n\t\t\t\t\t\t@click=\"activeMainTab = 'accessory'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t配饰\n\t\t\t\t\t</view>\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"main-tab-item\"\n\t\t\t\t\t\t:class=\"{ 'active': activeMainTab === 'pendant' }\"\n\t\t\t\t\t\t@click=\"activeMainTab = 'pendant'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t吊坠\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 内容区域 -->\n\t\t\t\t<view class=\"material-content\">\n\t\t\t\t\t<view v-if=\"loading\" class=\"loading-text\">正在加载商品...</view>\n\t\t\t\t\t<view v-else-if=\"error\" class=\"error-text\">加载失败：{{ error }}</view>\n\t\t\t\t\t<view v-else-if=\"!categorizedProducts\" class=\"loading-text\">暂无商品数据</view>\n\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t<!-- 珠子tab -->\n\t\t\t\t\t\t<view v-if=\"activeMainTab === 'bead'\" class=\"material-tab-content\">\n\t\t\t\t\t\t\t<!-- 左侧：子分类tab -->\n\t\t\t\t\t\t\t<view class=\"sub-tabs\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validBeadCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"sub-tab-item\"\n\t\t\t\t\t\t\t\t\t:class=\"{ 'active': activeBeadSubTab === category.key }\"\n\t\t\t\t\t\t\t\t\t@click=\"activeBeadSubTab = category.key\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ categorizedProducts[category.key]?.name || '' }}\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<!-- 右侧：商品列表 -->\n\t\t\t\t\t\t\t<scroll-view class=\"product-list\" scroll-y>\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-if=\"activeBeadSubTab && categorizedProducts[activeBeadSubTab] && categorizedProducts[activeBeadSubTab].products\"\n\t\t\t\t\t\t\t\t\tclass=\"product-grid\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[activeBeadSubTab].products\"\n\t\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t\t@click=\"selectBeadProduct(product)\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view v-else class=\"empty-text\">请选择分类</view>\n\t\t\t\t\t\t\t</scroll-view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- 配饰tab -->\n\t\t\t\t\t\t<view v-if=\"activeMainTab === 'accessory'\" class=\"material-tab-content\">\n\t\t\t\t\t\t\t<!-- 左侧：子分类tab -->\n\t\t\t\t\t\t\t<view class=\"sub-tabs\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validAccessoryCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"sub-tab-item\"\n\t\t\t\t\t\t\t\t\t:class=\"{ 'active': activeAccessorySubTab === category.key }\"\n\t\t\t\t\t\t\t\t\t@click=\"activeAccessorySubTab = category.key\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ categorizedProducts[category.key]?.name || '' }}\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<!-- 右侧：商品列表 -->\n\t\t\t\t\t\t\t<scroll-view class=\"product-list\" scroll-y>\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-if=\"activeAccessorySubTab && categorizedProducts[activeAccessorySubTab] && categorizedProducts[activeAccessorySubTab].products\"\n\t\t\t\t\t\t\t\t\tclass=\"product-grid\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[activeAccessorySubTab].products\"\n\t\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t\t@click=\"selectAccessoryProduct(product)\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view v-else class=\"empty-text\">请选择分类</view>\n\t\t\t\t\t\t\t</scroll-view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- 吊坠tab -->\n\t\t\t\t\t\t<view v-if=\"activeMainTab === 'pendant'\" class=\"material-tab-content\">\n\t\t\t\t\t\t\t<scroll-view class=\"product-list-full\" scroll-y>\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-if=\"categorizedProducts.pendant && categorizedProducts.pendant.products\"\n\t\t\t\t\t\t\t\t\tclass=\"product-grid\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts.pendant.products\"\n\t\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t\t@click=\"selectPendantProduct(product)\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view v-else class=\"empty-text\">暂无吊坠商品</view>\n\t\t\t\t\t\t\t</scroll-view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 保存作品区域 -->\n\t\t\t\t\t<view class=\"save-section-compact\">\n\t\t\t\t\t\t<view class=\"save-form-item\">\n\t\t\t\t\t\t\t<text class=\"save-label\">作品名称</text>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\tv-model=\"designName\" \n\t\t\t\t\t\t\t\tplaceholder=\"给你的作品起个名字\"\n\t\t\t\t\t\t\t\tclass=\"save-input\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"save-btn-group\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tclass=\"save-btn-compact secondary\" \n\t\t\t\t\t\t\t\t:disabled=\"items.length === 0 || saving || processingOrder\"\n\t\t\t\t\t\t\t@click=\"saveDesign\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ saving ? '保存中...' : '仅保存' }}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tclass=\"save-btn-compact\" \n\t\t\t\t\t\t\t\t:disabled=\"items.length === 0 || processingOrder\"\n\t\t\t\t\t\t\t\t@click=\"completeAndGoToCashier\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ processingOrder ? '处理中...' : '完成' }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 可滚动：材料选择区域（旧版，待删除） -->\n\t\t\t<scroll-view \n\t\t\t\tclass=\"config-panel\" \n\t\t\t\t:scroll-y=\"!dragState.isDragging\"\n\t\t\t\t:enable-back-to-top=\"!dragState.isDragging\"\n\t\t\t\tstyle=\"display: none;\"\n\t\t\t>\n\t\t\t\t<view v-if=\"loading\" class=\"loading-text\">正在加载商品...</view>\n\t\t\t\t<view v-else-if=\"error\" class=\"error-text\">加载失败：{{ error }}</view>\n\t\t\t\t<view v-else-if=\"!categorizedProducts\" class=\"loading-text\">暂无商品数据</view>\n\t\t\t\t<view v-else>\n\t\t\t\t\t<!-- 珠子 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-header\">\n\t\t\t\t\t\t\t<view class=\"section-title\">珠子</view>\n\t\t\t\t\t\t\t<view v-if=\"beadStep !== 'category'\" class=\"back-btn\" @click=\"resetBeadSelection\">\n\t\t\t\t\t\t\t\t<text>← 返回</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-if=\"beadStep === 'category'\">\n\t\t\t\t\t\t\t<view class=\"category-grid\" v-if=\"categorizedProducts && validBeadCategories.length > 0\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validBeadCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"category-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectBeadCategory(category.key)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getCategoryImage(category.key)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"category-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"category-name\">{{ categorizedProducts[category.key]?.name || '' }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t\t<view class=\"section-subtitle\" v-if=\"selectedBeadCategory && categorizedProducts && categorizedProducts[selectedBeadCategory]\">\n\t\t\t\t\t\t\t\t选择 {{ categorizedProducts[selectedBeadCategory]?.name || '' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"product-grid\" v-if=\"selectedBeadCategory && categorizedProducts && categorizedProducts[selectedBeadCategory] && categorizedProducts[selectedBeadCategory].products\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[selectedBeadCategory].products\"\n\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectBeadProduct(product)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 配饰 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-header\">\n\t\t\t\t\t\t\t<view class=\"section-title\">配饰</view>\n\t\t\t\t\t\t\t<view v-if=\"accessoryStep !== 'category'\" class=\"back-btn\" @click=\"resetAccessorySelection\">\n\t\t\t\t\t\t\t\t<text>← 返回</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-if=\"accessoryStep === 'category'\">\n\t\t\t\t\t\t\t<view class=\"category-grid\" v-if=\"categorizedProducts && validAccessoryCategories.length > 0\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"category in validAccessoryCategories\" \n\t\t\t\t\t\t\t\t\t:key=\"category.key\"\n\t\t\t\t\t\t\t\t\tclass=\"category-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectAccessoryCategory(category.key)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getCategoryImage(category.key)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"category-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"category-name\">{{ categorizedProducts[category.key]?.name || '' }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t\t<view class=\"section-subtitle\" v-if=\"selectedAccessoryCategory && categorizedProducts && categorizedProducts[selectedAccessoryCategory]\">\n\t\t\t\t\t\t\t\t选择 {{ categorizedProducts[selectedAccessoryCategory]?.name || '' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"product-grid\" v-if=\"selectedAccessoryCategory && categorizedProducts && categorizedProducts[selectedAccessoryCategory] && categorizedProducts[selectedAccessoryCategory].products\">\n\t\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts[selectedAccessoryCategory].products\"\n\t\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t\t@click=\"selectAccessoryProduct(product)\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 吊坠 -->\n\t\t\t\t\t<view class=\"section\">\n\t\t\t\t\t\t<view class=\"section-title\">吊坠</view>\n\t\t\t\t\t\t<view v-if=\"!categorizedProducts || !categorizedProducts.pendant || !categorizedProducts.pendant.products || categorizedProducts.pendant.products.length === 0\" class=\"empty-text\">\n\t\t\t\t\t\t\t暂无吊坠商品\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-else class=\"product-grid\">\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tv-for=\"product in categorizedProducts.pendant.products\"\n\t\t\t\t\t\t\t\t:key=\"product.id\"\n\t\t\t\t\t\t\t\tclass=\"product-item\"\n\t\t\t\t\t\t\t\t@click=\"selectPendantProduct(product)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\t\t:src=\"getProductImage(product)\" \n\t\t\t\t\t\t\t\t\tclass=\"product-image\"\n\t\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<text class=\"product-name\">{{ product.title }}</text>\n\t\t\t\t\t\t\t\t<text class=\"product-price\">¥{{ getProductPrice(product) }}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 保存作品区域 -->\n\t\t\t\t\t<view class=\"save-section\">\n\t\t\t\t\t\t<view class=\"form-item\">\n\t\t\t\t\t\t\t<view class=\"label\">作品名称</view>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\tv-model=\"designName\" \n\t\t\t\t\t\t\t\tplaceholder=\"给你的作品起个名字吧\"\n\t\t\t\t\t\t\t\tclass=\"input\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"save-btn\" \n\t\t\t\t\t\t\t:disabled=\"items.length === 0 || saving\"\n\t\t\t\t\t\t\t@click=\"saveDesign\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ saving ? '保存中...' : '保存到我的作品集' }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { productAPI, designAPI, cartAPI } from '@/utils/api.js'\n\timport { \n\t\tcategorizeProducts, \n\t\tgetProductImage, \n\t\tgetProductPrice, \n\t\tgetProductDiameter, \n\t\tgetProductWeight,\n\t\tparseDiameter,\n\t\tparseWeight,\n\t\tcalculateTotalPrice,\n\t\tgenerateId\n\t} from '@/utils/bracelet.js'\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading: true,\n\t\t\t\terror: null,\n\t\t\t\tcategorizedProducts: null,\n\t\t\t\titems: [],\n\t\t\t\tshowWristSizeModal: false, // 默认不显示，因为已经有默认值\n\t\t\t\twristSize: 16, // 默认手围16\n\t\t\t\twristSizeInput: '16',\n\t\t\t\twearingStyle: 'single', // 默认单圈\n\t\t\t\tdesignName: '',\n\t\t\t\tcurrentDesignId: null,\n\t\t\t\tsaving: false,\n\t\t\t\tcanvasCtx: null, // Canvas 上下文\n\t\t\t\t// 拖拽状态\n\t\t\t\tdragState: {\n\t\t\t\t\tisDragging: false,\n\t\t\t\t\tdragItemId: null,\n\t\t\t\t\tdragItemIndex: -1,\n\t\t\t\t\tstartX: 0,\n\t\t\t\t\tstartY: 0,\n\t\t\t\t\tcurrentX: 0,\n\t\t\t\t\tcurrentY: 0,\n\t\t\t\t\tisOverDeleteZone: false,\n\t\t\t\t\tnearestBeadIndex: -1, // 最近的珠子索引（用于换位置）\n\t\t\t\t\tlongPressTimer: null,\n\t\t\t\t\tdrawTimer: null, // 绘制节流定时器\n\t\t\t\t\tcanvasRect: null // 缓存 canvas 位置\n\t\t\t\t},\n\t\t\t\t// 珠子选择状态\n\t\t\t\tbeadStep: 'category',\n\t\t\t\tselectedBeadCategory: null,\n\t\t\t\t// 配饰选择状态\n\t\t\t\taccessoryStep: 'category',\n\t\t\t\tselectedAccessoryCategory: null,\n\t\t\t\t// 新的tab状态\n\t\t\t\tactiveMainTab: 'bead', // 主tab：bead, accessory, pendant\n\t\t\t\tactiveBeadSubTab: null, // 珠子子tab：obsidian, amethyst, moonshine\n\t\t\t\tactiveAccessorySubTab: null, // 配饰子tab\n\t\t\t\t// 分类映射\n\t\t\t\tbeadCategories: [\n\t\t\t\t\t{ key: 'obsidian', category: 'obsidian' },\n\t\t\t\t\t{ key: 'amethyst', category: 'amethyst' },\n\t\t\t\t\t{ key: 'moonshine', category: 'moonstone' }\n\t\t\t\t],\n\t\t\t\taccessoryCategories: [\n\t\t\t\t\t{ key: 'cutoff', category: 'spacer' },\n\t\t\t\t\t{ key: 'running-laps', category: 'decoration' },\n\t\t\t\t\t{ key: 'double-pointed-crystal', category: 'doubleTerminated' }\n\t\t\t\t],\n\t\t\t\t// 下单 / 收银台流程状态\n\t\t\t\tprocessingOrder: false\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\ttotalPrice() {\n\t\t\t\treturn calculateTotalPrice(this.items)\n\t\t\t},\n\t\t\t// 过滤有效的珠子分类\n\t\t\tvalidBeadCategories() {\n\t\t\t\tif (!this.categorizedProducts) return []\n\t\t\t\treturn this.beadCategories.filter(category => {\n\t\t\t\t\treturn category && \n\t\t\t\t\t\tcategory.key && \n\t\t\t\t\t\tthis.categorizedProducts[category.key] && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products.length > 0\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 过滤有效的配饰分类\n\t\t\tvalidAccessoryCategories() {\n\t\t\t\tif (!this.categorizedProducts) return []\n\t\t\t\treturn this.accessoryCategories.filter(category => {\n\t\t\t\t\treturn category && \n\t\t\t\t\t\tcategory.key && \n\t\t\t\t\t\tthis.categorizedProducts[category.key] && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products && \n\t\t\t\t\t\tthis.categorizedProducts[category.key].products.length > 0\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 预览尺寸（像素）- 用于计算\n\t\t\tpreviewSize() {\n\t\t\t\t// 放大预览区域到 260px，使手串更易点击\n\t\t\t\treturn 260\n\t\t\t},\n\t\t\t// 预览尺寸（像素）- 用于样式（rpx转px）\n\t\t\tpreviewSizePx() {\n\t\t\t\t// 获取系统信息，计算实际像素值\n\t\t\t\tconst systemInfo = uni.getSystemInfoSync()\n\t\t\t\tconst screenWidth = systemInfo.screenWidth\n\t\t\t\t// 预览区域放大到 500rpx，使视觉更大\n\t\t\t\treturn (500 / 750) * screenWidth\n\t\t\t},\n\t\t\t// 中心点坐标\n\t\t\tcenterX() {\n\t\t\t\treturn this.previewSize / 2\n\t\t\t},\n\t\t\tcenterY() {\n\t\t\t\treturn this.previewSize / 2\n\t\t\t},\n\t\t\t// 基础半径\n\t\t\tradius() {\n\t\t\t\t// 稍微放大圆半径，让手串占据更多空间\n\t\t\t\treturn this.previewSize * 0.35\n\t\t\t},\n\t\t\t// 默认直径（毫米）\n\t\t\tdefaultDiameter() {\n\t\t\t\treturn 8\n\t\t\t},\n\t\t\t// 毫米转像素比例\n\t\t\tmmToPx() {\n\t\t\t\t// 放大珠子尺寸，提升可点击性\n\t\t\t\treturn 3.0\n\t\t\t},\n\t\t\t// 最大和最小缩放因子\n\t\t\tmaxPreferredScale() {\n\t\t\t\treturn 2.0\n\t\t\t},\n\t\t\tminPreferredScale() {\n\t\t\t\treturn 0.25\n\t\t\t},\n\t\t\t// 计算当前周长（厘米）\n\t\t\tcurrentCircumference() {\n\t\t\t\tconst totalDiameterMm = this.items.reduce((sum, item) => {\n\t\t\t\t\treturn sum + (item.diameter || this.defaultDiameter)\n\t\t\t\t}, 0)\n\t\t\t\treturn totalDiameterMm / 10 // 毫米转厘米\n\t\t\t},\n\t\t\t// 计算最大周长\n\t\t\tmaxCircumference() {\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) return null\n\t\t\t\treturn this.wearingStyle === 'single' ? this.wristSize * 1.1 : this.wristSize * 2.2\n\t\t\t},\n\t\t\t// 是否达到设定手围\n\t\t\treachesLimit() {\n\t\t\t\tif (!this.maxCircumference || this.items.length === 0) return false\n\t\t\t\treturn this.currentCircumference >= this.maxCircumference * 0.95\n\t\t\t},\n\t\t\t// 是否超过设定手围\n\t\t\texceedsLimit() {\n\t\t\t\treturn this.maxCircumference !== null && this.currentCircumference > this.maxCircumference\n\t\t\t},\n\t\t\t// 计算珠子大小的缩放因子\n\t\t\tbeadScale() {\n\t\t\t\tif (this.items.length === 0) return this.maxPreferredScale\n\n\t\t\t\tconst target = 2 * Math.PI\n\n\t\t\t\tconst totalAngleForScale = (scale) => {\n\t\t\t\t\tlet total = 0\n\t\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\t\tconst a = this.items[i]\n\t\t\t\t\t\tconst b = this.items[(i + 1) % this.items.length]\n\t\t\t\t\t\tconst d1 = a.diameter ?? this.defaultDiameter\n\t\t\t\t\t\tconst d2 = b.diameter ?? this.defaultDiameter\n\t\t\t\t\t\tconst r1 = (d1 / 2) * this.mmToPx * scale\n\t\t\t\t\t\tconst r2 = (d2 / 2) * this.mmToPx * scale\n\t\t\t\t\t\tconst combined = r1 + r2\n\t\t\t\t\t\tconst safeRatio = Math.min(combined / (2 * this.radius), 0.999)\n\t\t\t\t\t\ttotal += 2 * Math.asin(safeRatio)\n\t\t\t\t\t}\n\t\t\t\t\treturn total\n\t\t\t\t}\n\n\t\t\t\tconst maxScale = this.maxPreferredScale\n\t\t\t\tconst minScale = this.minPreferredScale\n\n\t\t\t\tconst totalAtMax = totalAngleForScale(maxScale)\n\t\t\t\tif (Math.abs(totalAtMax - target) < 1e-4) return maxScale\n\t\t\t\tif (totalAtMax < target) {\n\t\t\t\t\treturn maxScale\n\t\t\t\t}\n\n\t\t\t\tconst totalAtMin = totalAngleForScale(minScale)\n\t\t\t\tif (totalAtMin > target) {\n\t\t\t\t\treturn minScale\n\t\t\t\t}\n\n\t\t\t\t// 二分查找\n\t\t\t\tlet lo = minScale\n\t\t\t\tlet hi = maxScale\n\t\t\t\tlet best = minScale\n\t\t\t\tfor (let iter = 0; iter < 50; iter++) {\n\t\t\t\t\tconst mid = (lo + hi) / 2\n\t\t\t\t\tconst t = totalAngleForScale(mid)\n\t\t\t\t\tif (Math.abs(t - target) < 1e-4) {\n\t\t\t\t\t\tbest = mid\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif (t > target) {\n\t\t\t\t\t\thi = mid\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlo = mid\n\t\t\t\t\t\tbest = mid\n\t\t\t\t\t}\n\t\t\t\t\tif (hi - lo < 1e-4) break\n\t\t\t\t}\n\n\t\t\t\treturn best\n\t\t\t},\n\t\t\t// 计算角度间隔\n\t\t\tangleSteps() {\n\t\t\t\tif (this.items.length === 0) return []\n\t\t\t\t\n\t\t\t\tconst steps = []\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\tconst currentItem = this.items[i]\n\t\t\t\t\tconst nextItem = this.items[(i + 1) % this.items.length]\n\t\t\t\t\t\n\t\t\t\t\tconst radius1 = this.getBeadRadius(currentItem.diameter)\n\t\t\t\t\tconst radius2 = this.getBeadRadius(nextItem.diameter)\n\t\t\t\t\tconst combinedRadius = radius1 + radius2\n\t\t\t\t\tconst safeRatio = Math.min(combinedRadius / (2 * this.radius), 0.999)\n\t\t\t\t\tconst angleStep = 2 * Math.asin(safeRatio)\n\t\t\t\t\tsteps.push(angleStep)\n\t\t\t\t}\n\t\t\t\treturn steps\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tif (options.designId) {\n\t\t\t\t// 编辑已有作品：加载作品并使用已有手围配置\n\t\t\t\tthis.loadDesign(options.designId)\n\t\t\t} else {\n\t\t\t\t// 新建作品：首次进入时要求设置手围\n\t\t\t\tthis.showWristSizeModal = true\n\t\t\t}\n\t\t\tthis.fetchProducts()\n\t\t\t// 延迟初始化 canvas，确保 DOM 已渲染\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.initCanvas()\n\t\t\t\t}, 500)\n\t\t\t})\n\t\t},\n\t\twatch: {\n\t\t\titems: {\n\t\t\t\thandler() {\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tdeep: true\n\t\t\t},\n\t\t\twristSize() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t})\n\t\t\t},\n\t\t\twearingStyle() {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 监听主tab切换，自动设置第一个子tab\n\t\t\tactiveMainTab(newVal) {\n\t\t\t\tif (newVal === 'bead' && this.validBeadCategories.length > 0) {\n\t\t\t\t\tthis.activeBeadSubTab = this.validBeadCategories[0].key\n\t\t\t\t} else if (newVal === 'accessory' && this.validAccessoryCategories.length > 0) {\n\t\t\t\t\tthis.activeAccessorySubTab = this.validAccessoryCategories[0].key\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 监听珠子分类变化，自动设置第一个子tab\n\t\t\tvalidBeadCategories: {\n\t\t\t\thandler(newVal) {\n\t\t\t\t\tif (this.activeMainTab === 'bead' && newVal.length > 0 && !this.activeBeadSubTab) {\n\t\t\t\t\t\tthis.activeBeadSubTab = newVal[0].key\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\timmediate: true\n\t\t\t},\n\t\t\t// 监听配饰分类变化，自动设置第一个子tab\n\t\t\tvalidAccessoryCategories: {\n\t\t\t\thandler(newVal) {\n\t\t\t\t\tif (this.activeMainTab === 'accessory' && newVal.length > 0 && !this.activeAccessorySubTab) {\n\t\t\t\t\t\tthis.activeAccessorySubTab = newVal[0].key\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\timmediate: true\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tasync fetchProducts() {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.error = null\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await productAPI.getProducts()\n\t\t\t\t\t// 处理返回的数据结构\n\t\t\t\t\tconst products = res.products || res || []\n\t\t\t\t\tif (!Array.isArray(products)) {\n\t\t\t\t\t\tthrow new Error('商品数据格式不正确')\n\t\t\t\t\t}\n\t\t\t\t\tthis.categorizedProducts = categorizeProducts(products)\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthis.error = err.message || '拉取商品失败'\n\t\t\t\t\tconsole.error('拉取商品失败：', err)\n\t\t\t\t\tthis.categorizedProducts = null\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tasync loadDesign(id) {\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await designAPI.getDesign(id)\n\t\t\t\t\tconst design = res.design\n\t\t\t\t\tif (design) {\n\t\t\t\t\t\tthis.items = design.items || []\n\t\t\t\t\t\tthis.wristSize = design.wristSize || 16\n\t\t\t\t\t\tthis.wristSizeInput = String(this.wristSize)\n\t\t\t\t\t\tthis.wearingStyle = design.wearingStyle || 'single'\n\t\t\t\t\t\tthis.showWristSizeModal = false\n\t\t\t\t\t\tthis.designName = design.name || ''\n\t\t\t\t\t\tthis.currentDesignId = design.id\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error('加载作品失败：', err)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '加载作品失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tgetCategoryImage(categoryKey) {\n\t\t\t\tif (!this.categorizedProducts || !categoryKey || !this.categorizedProducts[categoryKey]) {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t\tconst products = this.categorizedProducts[categoryKey]?.products\n\t\t\t\tif (products && products.length > 0) {\n\t\t\t\t\treturn getProductImage(products[0])\n\t\t\t\t}\n\t\t\t\treturn ''\n\t\t\t},\n\t\t\t\n\t\t\tgetProductImage,\n\t\t\tgetProductPrice,\n\t\t\t\n\t\t\tcheckWristSizeLimit(newDiameter) {\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) return true\n\t\t\t\t\n\t\t\t\tconst maxCircumference = this.wearingStyle === 'single' \n\t\t\t\t\t? this.wristSize * 1.1 \n\t\t\t\t\t: this.wristSize * 2.2\n\t\t\t\tconst defaultDiameter = 8\n\t\t\t\tconst currentTotalDiameterMm = this.items.reduce((sum, item) => {\n\t\t\t\t\treturn sum + (item.diameter || defaultDiameter)\n\t\t\t\t}, 0)\n\t\t\t\tconst newTotalDiameterMm = currentTotalDiameterMm + (newDiameter || defaultDiameter)\n\t\t\t\tconst newCircumference = newTotalDiameterMm / 10\n\t\t\t\t\n\t\t\t\treturn newCircumference <= maxCircumference\n\t\t\t},\n\t\t\t\n\t\t\tselectBeadCategory(categoryKey) {\n\t\t\t\tthis.selectedBeadCategory = categoryKey\n\t\t\t\tthis.beadStep = 'product'\n\t\t\t},\n\t\t\t\n\t\t\tresetBeadSelection() {\n\t\t\t\tthis.beadStep = 'category'\n\t\t\t\tthis.selectedBeadCategory = null\n\t\t\t},\n\t\t\t\n\t\t\tselectBeadProduct(product) {\n\t\t\t\tif (!this.activeBeadSubTab) return\n\t\t\t\t\n\t\t\t\tconst category = this.beadCategories.find(c => c && c.key === this.activeBeadSubTab)\n\t\t\t\tif (!category || !category.category) return\n\t\t\t\t\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多珠子。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'bead',\n\t\t\t\t\tbeadCategory: category.category,\n\t\t\t\t\tbeadSubType: product.title,\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t\t// 新UI不需要重置，保持在当前tab\n\t\t\t},\n\t\t\t\n\t\t\tselectAccessoryCategory(categoryKey) {\n\t\t\t\tthis.selectedAccessoryCategory = categoryKey\n\t\t\t\tthis.accessoryStep = 'product'\n\t\t\t},\n\t\t\t\n\t\t\tresetAccessorySelection() {\n\t\t\t\tthis.accessoryStep = 'category'\n\t\t\t\tthis.selectedAccessoryCategory = null\n\t\t\t},\n\t\t\t\n\t\t\tselectAccessoryProduct(product) {\n\t\t\t\tif (!this.activeAccessorySubTab) return\n\t\t\t\t\n\t\t\t\tconst category = this.accessoryCategories.find(c => c && c.key === this.activeAccessorySubTab)\n\t\t\t\tif (!category || !category.category) return\n\t\t\t\t\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多配饰。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'accessory',\n\t\t\t\t\taccessoryCategory: category.category,\n\t\t\t\t\taccessorySubType: product.title,\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t\t// 新UI不需要重置，保持在当前tab\n\t\t\t},\n\t\t\t\n\t\t\tselectPendantProduct(product) {\n\t\t\t\tconst diameterStr = getProductDiameter(product)\n\t\t\t\tconst weightStr = getProductWeight(product)\n\t\t\t\tconst diameter = diameterStr ? parseDiameter(diameterStr) : undefined\n\t\t\t\tconst weight = weightStr ? parseWeight(weightStr) : undefined\n\t\t\t\t\n\t\t\t\tif (!this.checkWristSizeLimit(diameter || 8)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到设定手围！无法添加更多吊坠。',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst newItem = {\n\t\t\t\t\tid: generateId(),\n\t\t\t\t\ttype: 'pendant',\n\t\t\t\t\tpendantType: 'pendant',\n\t\t\t\t\tname: product.title,\n\t\t\t\t\tprice: getProductPrice(product),\n\t\t\t\t\tcolor: '#8b4513',\n\t\t\t\t\timage: getProductImage(product),\n\t\t\t\t\tdiameter,\n\t\t\t\t\tweight\n\t\t\t\t}\n\t\t\t\tthis.items.push(newItem)\n\t\t\t},\n\t\t\t\n\t\t\tremoveItem(id) {\n\t\t\t\t// 添加删除动画效果\n\t\t\t\tconst index = this.items.findIndex(item => item.id === id)\n\t\t\t\tif (index === -1) return\n\t\t\t\t\n\t\t\t\t// 移除震动反馈，避免屏幕抖动\n\t\t\t\t// uni.vibrateShort({\n\t\t\t\t// \ttype: 'heavy'\n\t\t\t\t// })\n\t\t\t\t\n\t\t\t\t// 显示删除提示\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '已删除',\n\t\t\t\t\ticon: 'success',\n\t\t\t\t\tduration: 500\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t// 延迟删除，让用户看到反馈\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.items = this.items.filter(item => item.id !== id)\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t}, 100)\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子半径（像素）\n\t\t\tgetBeadRadius(diameter) {\n\t\t\t\tconst diameterMm = diameter || this.defaultDiameter\n\t\t\t\treturn (diameterMm / 2) * this.mmToPx * this.beadScale\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的角度位置\n\t\t\tgetItemAngle(index) {\n\t\t\t\tif (index === 0) return 0\n\t\t\t\t\n\t\t\t\tlet cumulativeAngle = 0\n\t\t\t\tfor (let i = 0; i < index; i++) {\n\t\t\t\t\tcumulativeAngle += this.angleSteps[i]\n\t\t\t\t}\n\t\t\t\treturn cumulativeAngle\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的 X 坐标\n\t\t\tgetItemX(index) {\n\t\t\t\tconst angle = this.getItemAngle(index)\n\t\t\t\treturn this.centerX + this.radius * Math.cos(angle)\n\t\t\t},\n\t\t\t\n\t\t\t// 获取珠子的 Y 坐标\n\t\t\tgetItemY(index) {\n\t\t\t\tconst angle = this.getItemAngle(index)\n\t\t\t\treturn this.centerY + this.radius * Math.sin(angle)\n\t\t\t},\n\t\t\t\n\t\t\t// 初始化 canvas\n\t\t\tinitCanvas() {\n\t\t\t\t// 使用 uni.createCanvasContext 创建 canvas 上下文（适用于微信小程序）\n\t\t\t\tthis.canvasCtx = uni.createCanvasContext('braceletCanvas', this)\n\t\t\t\t// 延迟绘制，确保 canvas 已渲染\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t}, 100)\n\t\t\t},\n\t\t\t\n\t\t\t// 绘制手串\n\t\t\tdrawBracelet() {\n\t\t\t\tif (!this.canvasCtx) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst ctx = this.canvasCtx\n\t\t\t\tconst size = this.previewSize\n\t\t\t\t\n\t\t\t\t// 清空画布\n\t\t\t\tctx.clearRect(0, 0, size, size)\n\t\t\t\t\n\t\t\t\tif (this.items.length === 0) {\n\t\t\t\t\tctx.draw()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 绘制圆形路径（虚线）\n\t\t\t\tctx.beginPath()\n\t\t\t\tctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI)\n\t\t\t\tctx.setStrokeStyle('#e5e7eb')\n\t\t\t\tctx.setLineWidth(2)\n\t\t\t\t// 小程序中虚线使用 setLineDash\n\t\t\t\tctx.setLineDash([5, 5], 0)\n\t\t\t\tctx.stroke()\n\t\t\t\tctx.setLineDash([], 0)\n\t\t\t\t\n\t\t\t\t// 使用拖拽状态中保存的最近珠子索引\n\t\t\t\tconst nearestBeadIndex = this.dragState.nearestBeadIndex\n\t\t\t\t\n\t\t\t\t// 绘制所有珠子（被选中的珠子不绘制，让它消失）\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\t// 被选中的珠子不显示\n\t\t\t\t\tif (this.dragState.isDragging && i === this.dragState.dragItemIndex) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst item = this.items[i]\n\t\t\t\t\tconst x = this.getItemX(i)\n\t\t\t\t\tconst y = this.getItemY(i)\n\t\t\t\t\tconst radius = this.getBeadRadius(item.diameter)\n\t\t\t\t\tconst color = item.color || '#8b4513'\n\t\t\t\t\t\n\t\t\t\t\t// 如果是最近的珠子，先绘制虚线边框\n\t\t\t\t\tif (i === nearestBeadIndex) {\n\t\t\t\t\t\tctx.beginPath()\n\t\t\t\t\t\tctx.arc(x, y, radius + 4, 0, 2 * Math.PI)\n\t\t\t\t\t\tctx.setStrokeStyle('#3b82f6')\n\t\t\t\t\t\tctx.setLineWidth(3)\n\t\t\t\t\t\tctx.setLineDash([5, 5], 0)\n\t\t\t\t\t\tctx.stroke()\n\t\t\t\t\t\tctx.setLineDash([], 0)\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 绘制珠子\n\t\t\t\t\tctx.beginPath()\n\t\t\t\t\tctx.arc(x, y, radius, 0, 2 * Math.PI)\n\t\t\t\t\tctx.setFillStyle(color)\n\t\t\t\t\tctx.fill()\n\t\t\t\t\t\n\t\t\t\t\t// 绘制白色边框\n\t\t\t\t\tctx.setStrokeStyle('#ffffff')\n\t\t\t\t\tctx.setLineWidth(2)\n\t\t\t\t\tctx.stroke()\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 绘制到画布\n\t\t\t\tctx.draw()\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸开始 - 检测长按\n\t\t\thandleCanvasTouchStart(e) {\n\t\t\t\tif (this.items.length === 0) return\n\t\t\t\t\n\t\t\t\t// 阻止事件冒泡，防止页面滚动\n\t\t\t\te.stopPropagation()\n\t\t\t\t\n\t\t\t\tconst touch = e.touches[0]\n\t\t\t\t// 获取 canvas 的位置信息并缓存\n\t\t\t\tconst query = uni.createSelectorQuery().in(this)\n\t\t\t\tquery.select('.canvas-container').boundingClientRect((rect) => {\n\t\t\t\t\tif (!rect) return\n\t\t\t\t\t\n\t\t\t\t\t// 缓存 canvas 位置\n\t\t\t\t\tthis.dragState.canvasRect = rect\n\t\t\t\t\t\n\t\t\t\t\t// 计算相对于 canvas 的坐标\n\t\t\t\t\tconst x = touch.clientX - rect.left\n\t\t\t\t\tconst y = touch.clientY - rect.top\n\t\t\t\t\t\n\t\t\t\t\t// 找到点击的珠子\n\t\t\t\t\tconst itemIndex = this.findItemAtPosition(x, y)\n\t\t\t\t\tif (itemIndex === -1) return\n\t\t\t\t\t\n\t\t\t\t\t// 清除之前的定时器\n\t\t\t\t\tif (this.dragState.longPressTimer) {\n\t\t\t\t\t\tclearTimeout(this.dragState.longPressTimer)\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 设置长按定时器（500ms）\n\t\t\t\t\tthis.dragState.longPressTimer = setTimeout(() => {\n\t\t\t\t\t\tthis.startDrag(itemIndex, x, y)\n\t\t\t\t\t}, 500)\n\t\t\t\t}).exec()\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸移动\n\t\t\thandleCanvasTouchMove(e) {\n\t\t\t\t// 阻止事件冒泡和默认行为，彻底防止页面滚动\n\t\t\t\te.stopPropagation()\n\t\t\t\tif (e.preventDefault) {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!this.dragState.isDragging) {\n\t\t\t\t\t// 如果移动了，取消长按\n\t\t\t\t\tif (this.dragState.longPressTimer) {\n\t\t\t\t\t\tclearTimeout(this.dragState.longPressTimer)\n\t\t\t\t\t\tthis.dragState.longPressTimer = null\n\t\t\t\t\t}\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst touch = e.touches[0]\n\t\t\t\t\n\t\t\t\t// 使用缓存的 canvas 位置直接计算坐标，保证流畅\n\t\t\t\tconst canvasRect = this.dragState.canvasRect\n\t\t\t\tif (!canvasRect) {\n\t\t\t\t\t// 如果缓存不存在，立即获取（这种情况应该很少）\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this)\n\t\t\t\t\tquery.select('.canvas-container').boundingClientRect((rect) => {\n\t\t\t\t\t\tif (rect) {\n\t\t\t\t\t\t\tthis.dragState.canvasRect = rect\n\t\t\t\t\t\t\tconst x = touch.clientX - rect.left\n\t\t\t\t\t\t\tconst y = touch.clientY - rect.top\n\t\t\t\t\t\t\tthis.updateDragPosition(x, y, touch)\n\t\t\t\t\t\t}\n\t\t\t\t\t}).exec()\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 直接计算坐标，立即更新\n\t\t\t\tconst x = touch.clientX - canvasRect.left\n\t\t\t\tconst y = touch.clientY - canvasRect.top\n\t\t\t\tthis.updateDragPosition(x, y, touch)\n\t\t\t\t\n\t\t\t\treturn false\n\t\t\t},\n\t\t\t\n\t\t\t// 更新拖拽位置（节流绘制）\n\t\t\tupdateDragPosition(x, y, touch) {\n\t\t\t\t// 立即更新坐标，保证流畅\n\t\t\t\tthis.dragState.currentX = x\n\t\t\t\tthis.dragState.currentY = y\n\t\t\t\t\n\t\t\t\t// 节流绘制，避免频繁绘制导致卡顿\n\t\t\t\tif (this.dragState.drawTimer) {\n\t\t\t\t\tclearTimeout(this.dragState.drawTimer)\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 异步检查删除区域和位置，不阻塞坐标更新\n\t\t\t\tthis.dragState.drawTimer = setTimeout(() => {\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this)\n\t\t\t\t\tquery.select('.delete-zone').boundingClientRect((deleteRect) => {\n\t\t\t\t\t\t// 检查是否在删除区域\n\t\t\t\t\t\tif (deleteRect) {\n\t\t\t\t\t\t\tconst isInDeleteZone = touch.clientY >= deleteRect.top && \n\t\t\t\t\t\t\t\ttouch.clientY <= deleteRect.bottom &&\n\t\t\t\t\t\t\t\ttouch.clientX >= deleteRect.left && \n\t\t\t\t\t\t\t\ttouch.clientX <= deleteRect.right\n\t\t\t\t\t\t\tthis.dragState.isOverDeleteZone = isInDeleteZone\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.dragState.isOverDeleteZone = false\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 检查是否在预览区域内，找到最近的珠子\n\t\t\t\t\t\tif (this.isInPreviewArea(x, y)) {\n\t\t\t\t\t\t\tconst nearestIndex = this.findNearestBead(x, y, this.dragState.dragItemIndex)\n\t\t\t\t\t\t\tthis.dragState.nearestBeadIndex = nearestIndex\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.dragState.nearestBeadIndex = -1\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 重新绘制（显示拖拽动画效果）\n\t\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t\t}).exec()\n\t\t\t\t}, 16) // 约 60fps\n\t\t\t},\n\t\t\t\n\t\t\t// Canvas 触摸结束\n\t\t\thandleCanvasTouchEnd(e) {\n\t\t\t\t// 阻止事件冒泡\n\t\t\t\te.stopPropagation()\n\t\t\t\t\n\t\t\t\t// 清除长按定时器\n\t\t\t\tif (this.dragState.longPressTimer) {\n\t\t\t\t\tclearTimeout(this.dragState.longPressTimer)\n\t\t\t\t\tthis.dragState.longPressTimer = null\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!this.dragState.isDragging) return\n\t\t\t\t\n\t\t\t\t// 如果在删除区域，删除项目\n\t\t\t\tif (this.dragState.isOverDeleteZone) {\n\t\t\t\t\tthis.removeItem(this.dragState.dragItemId)\n\t\t\t\t\tthis.endDrag()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 如果有最近的珠子（显示虚线），直接换位置\n\t\t\t\tif (this.dragState.nearestBeadIndex !== -1 && \n\t\t\t\t\tthis.dragState.nearestBeadIndex !== this.dragState.dragItemIndex) {\n\t\t\t\t\tthis.swapItems(this.dragState.dragItemIndex, this.dragState.nearestBeadIndex)\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.endDrag()\n\t\t\t},\n\t\t\t\n\t\t\t// 开始拖拽\n\t\t\tstartDrag(itemIndex, x, y) {\n\t\t\t\tif (itemIndex < 0 || itemIndex >= this.items.length) return\n\t\t\t\t\n\t\t\t\t// canvas 位置已经在 touchstart 时缓存，这里直接使用\n\t\t\t\t// 如果缓存不存在，立即获取一次\n\t\t\t\tif (!this.dragState.canvasRect) {\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this)\n\t\t\t\t\tquery.select('.canvas-container').boundingClientRect((rect) => {\n\t\t\t\t\t\tif (rect) {\n\t\t\t\t\t\t\tthis.dragState.canvasRect = rect\n\t\t\t\t\t\t}\n\t\t\t\t\t}).exec()\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.dragState.isDragging = true\n\t\t\t\tthis.dragState.dragItemId = this.items[itemIndex].id\n\t\t\t\tthis.dragState.dragItemIndex = itemIndex\n\t\t\t\tthis.dragState.startX = x\n\t\t\t\tthis.dragState.startY = y\n\t\t\t\tthis.dragState.currentX = x\n\t\t\t\tthis.dragState.currentY = y\n\t\t\t\tthis.dragState.isOverDeleteZone = false\n\t\t\t\t\n\t\t\t\t// 禁用页面滚动\n\t\t\t\tthis.disableScroll()\n\t\t\t\t\n\t\t\t\t// 重新绘制，显示选中效果\n\t\t\t\tthis.drawBracelet()\n\t\t\t},\n\t\t\t\n\t\t\t// 结束拖拽\n\t\t\tendDrag() {\n\t\t\t\t// 清除绘制定时器\n\t\t\t\tif (this.dragState.drawTimer) {\n\t\t\t\t\tclearTimeout(this.dragState.drawTimer)\n\t\t\t\t\tthis.dragState.drawTimer = null\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.dragState.isDragging = false\n\t\t\t\tthis.dragState.dragItemId = null\n\t\t\t\tthis.dragState.dragItemIndex = -1\n\t\t\t\tthis.dragState.isOverDeleteZone = false\n\t\t\t\tthis.dragState.nearestBeadIndex = -1\n\t\t\t\tthis.dragState.canvasRect = null\n\t\t\t\t\n\t\t\t\t// 启用页面滚动\n\t\t\t\tthis.enableScroll()\n\t\t\t\t\n\t\t\t\t// 重新绘制\n\t\t\t\tthis.drawBracelet()\n\t\t\t},\n\t\t\t\n\t\t\t// 禁用滚动\n\t\t\tdisableScroll() {\n\t\t\t\t// 禁用页面滚动\n\t\t\t\tuni.pageScrollTo({\n\t\t\t\t\tscrollTop: 0,\n\t\t\t\t\tduration: 0\n\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\t// 启用滚动\n\t\t\tenableScroll() {\n\t\t\t\t// 滚动功能由 scroll-view 控制，这里不需要额外操作\n\t\t\t},\n\t\t\t\n\t\t\t// 查找指定位置的珠子索引\n\t\t\tfindItemAtPosition(x, y) {\n\t\t\t\tconst centerX = this.centerX\n\t\t\t\tconst centerY = this.centerY\n\t\t\t\t\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\tconst itemX = this.getItemX(i)\n\t\t\t\t\tconst itemY = this.getItemY(i)\n\t\t\t\t\tconst radius = this.getBeadRadius(this.items[i].diameter)\n\t\t\t\t\t\n\t\t\t\t\tconst distance = Math.sqrt(Math.pow(x - itemX, 2) + Math.pow(y - itemY, 2))\n\t\t\t\t\tif (distance <= radius + 5) { // 5px 的容差\n\t\t\t\t\t\treturn i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn -1\n\t\t\t},\n\t\t\t\n\t\t\t// 查找距离指定位置最近的珠子索引\n\t\t\tfindNearestBead(x, y, excludeIndex) {\n\t\t\t\tlet nearestIndex = -1\n\t\t\t\tlet minDistance = Infinity\n\t\t\t\t\n\t\t\t\tfor (let i = 0; i < this.items.length; i++) {\n\t\t\t\t\t// 排除被拖拽的珠子\n\t\t\t\t\tif (i === excludeIndex) continue\n\t\t\t\t\t\n\t\t\t\t\tconst itemX = this.getItemX(i)\n\t\t\t\t\tconst itemY = this.getItemY(i)\n\t\t\t\t\tconst radius = this.getBeadRadius(this.items[i].diameter)\n\t\t\t\t\t\n\t\t\t\t\t// 计算到珠子边缘的距离\n\t\t\t\t\tconst distance = Math.sqrt(Math.pow(x - itemX, 2) + Math.pow(y - itemY, 2)) - radius\n\t\t\t\t\t\n\t\t\t\t\t// 增大距离阈值，让换位置更容易触发（从50px改为80px）\n\t\t\t\t\tif (distance < minDistance && distance < 80) {\n\t\t\t\t\t\tminDistance = distance\n\t\t\t\t\t\tnearestIndex = i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn nearestIndex\n\t\t\t},\n\t\t\t\n\t\t\t// 检查是否在预览区域内\n\t\t\tisInPreviewArea(x, y) {\n\t\t\t\tconst size = this.previewSize\n\t\t\t\treturn x >= 0 && x <= size && y >= 0 && y <= size\n\t\t\t},\n\t\t\t\n\t\t\t// 交换两个项目的位置\n\t\t\tswapItems(index1, index2) {\n\t\t\t\tif (index1 < 0 || index1 >= this.items.length || \n\t\t\t\t\tindex2 < 0 || index2 >= this.items.length ||\n\t\t\t\t\tindex1 === index2) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 移除震动反馈，避免屏幕抖动\n\t\t\t\t// uni.vibrateShort()\n\t\t\t\t\n\t\t\t\t// 交换位置\n\t\t\t\tconst temp = this.items[index1]\n\t\t\t\tthis.$set(this.items, index1, this.items[index2])\n\t\t\t\tthis.$set(this.items, index2, temp)\n\t\t\t\t\n\t\t\t\t// 重新绘制，显示新位置\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.drawBracelet()\n\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\tcompleteWristSize() {\n\t\t\t\tconst size = parseFloat(this.wristSizeInput)\n\t\t\t\tif (!size || size <= 0) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入有效的手围',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.wearingStyle) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请选择佩戴方式',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.wristSize = size\n\t\t\t\tthis.showWristSizeModal = false\n\t\t\t},\n\t\t\t\n\t\t\tcloseModal() {\n\t\t\t\t// 允许关闭，因为有默认值\n\t\t\t\tthis.showWristSizeModal = false\n\t\t\t},\n\t\t\t\n\t\t\tasync saveDesign() {\n\t\t\t\tif (!this.items.length) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先设计手串再保存～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先完成手腕尺寸设置～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tthis.showWristSizeModal = true\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst trimmed = this.designName.trim()\n\t\t\t\tif (!trimmed) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先输入作品名称',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.saving = true\n\t\t\t\ttry {\n\t\t\t\t\tconst totalWeight = this.items.reduce((sum, item) => sum + (item.weight || 0), 0)\n\t\t\t\t\tconst diameters = this.items.map(i => i.diameter).filter(d => !!d)\n\t\t\t\t\tconst averageDiameter = diameters.length > 0\n\t\t\t\t\t\t? diameters.reduce((a, b) => a + b, 0) / diameters.length\n\t\t\t\t\t\t: null\n\t\t\t\t\t\n\t\t\t\t\tconst designData = {\n\t\t\t\t\t\tid: this.currentDesignId || undefined,\n\t\t\t\t\t\tname: trimmed,\n\t\t\t\t\t\titems: this.items,\n\t\t\t\t\t\ttotalPrice: this.totalPrice,\n\t\t\t\t\t\ttotalWeight: totalWeight,\n\t\t\t\t\t\taverageDiameter: averageDiameter,\n\t\t\t\t\t\twristSize: this.wristSize,\n\t\t\t\t\t\twearingStyle: this.wearingStyle\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst res = await designAPI.saveDesign(designData)\n\t\t\t\t\tthis.currentDesignId = res.design.id\n\t\t\t\t\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '保存成功',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\turl: '/pages/portfolio/portfolio'\n\t\t\t\t\t\t})\n\t\t\t\t\t}, 1500)\n\t\t\t\t} catch (err) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: err.message || '保存失败，请稍后重试',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.saving = false\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 完成并前往收银台\n\t\t\tasync completeAndGoToCashier() {\n\t\t\t\tif (this.processingOrder) return\n\t\t\t\tif (!this.items.length) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先设计手串再完成～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.wristSize || !this.wearingStyle) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先完成手腕尺寸设置～',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tthis.showWristSizeModal = true\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst trimmed = this.designName.trim()\n\t\t\t\tif (!trimmed) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请先输入作品名称',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.processingOrder = true\n\t\t\t\ttry {\n\t\t\t\t\t// 先保存设计，确保有设计ID\n\t\t\t\t\tconst totalWeight = this.items.reduce((sum, item) => sum + (item.weight || 0), 0)\n\t\t\t\t\tconst diameters = this.items.map(i => i.diameter).filter(d => !!d)\n\t\t\t\t\tconst averageDiameter = diameters.length > 0\n\t\t\t\t\t\t? diameters.reduce((a, b) => a + b, 0) / diameters.length\n\t\t\t\t\t\t: null\n\t\t\t\t\t\n\t\t\t\t\tconst designData = {\n\t\t\t\t\t\tid: this.currentDesignId || undefined,\n\t\t\t\t\t\tname: trimmed,\n\t\t\t\t\t\titems: this.items,\n\t\t\t\t\t\ttotalPrice: this.totalPrice,\n\t\t\t\t\t\ttotalWeight: totalWeight,\n\t\t\t\t\t\taverageDiameter: averageDiameter,\n\t\t\t\t\t\twristSize: this.wristSize,\n\t\t\t\t\t\twearingStyle: this.wearingStyle\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst res = await designAPI.saveDesign(designData)\n\t\t\t\t\tthis.currentDesignId = res.design.id\n\t\t\t\t\t\n\t\t\t\t\t// 跳转到收银台页面，携带设计信息\n\t\t\t\t\tconst payload = encodeURIComponent(JSON.stringify({\n\t\t\t\t\t\tdesignId: this.currentDesignId,\n\t\t\t\t\t\tname: trimmed,\n\t\t\t\t\t\ttotalPrice: this.totalPrice\n\t\t\t\t\t}))\n\t\t\t\t\t\n\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\turl: `/pages/cashier/cashier?data=${payload}`\n\t\t\t\t\t})\n\t\t\t\t} catch (err) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: err.message || '处理失败，请稍后重试',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t} finally {\n\t\t\t\t\tthis.processingOrder = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.container {\n\t\tmin-height: 100vh;\n\t\tbackground: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 40%, #f3e8ff 100%);\n\t\tpadding: 24rpx;\n\t}\n\t\n\t.modal-overlay {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tz-index: 1000;\n\t}\n\t\n\t.modal-content {\n\t\tbackground: #ffffff;\n\t\tborder-radius: 24rpx;\n\t\tpadding: 60rpx 40rpx;\n\t\twidth: 80%;\n\t\tmax-width: 600rpx;\n\t}\n\t\n\t.modal-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t\tmargin-bottom: 40rpx;\n\t\ttext-align: center;\n\t}\n\t\n\t.form-item {\n\t\tmargin-bottom: 40rpx;\n\t}\n\t\n\t.label {\n\t\tfont-size: 28rpx;\n\t\tfont-weight: 600;\n\t\tcolor: #374151;\n\t\tmargin-bottom: 16rpx;\n\t\tdisplay: block;\n\t}\n\t\n\t.input {\n\t\twidth: 100%;\n\t\theight: 88rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 0 24rpx;\n\t\tfont-size: 28rpx;\n\t\tbackground: #ffffff;\n\t}\n\t\n\t.radio-group {\n\t\tdisplay: flex;\n\t\tgap: 20rpx;\n\t}\n\t\n\t.radio-item {\n\t\tflex: 1;\n\t\tpadding: 24rpx;\n\t\tborder: 4rpx solid #e5e7eb;\n\t\tborder-radius: 16rpx;\n\t\ttext-align: center;\n\t\tfont-size: 28rpx;\n\t\tcolor: #6b7280;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.radio-item.active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t}\n\t\n\t.modal-btn {\n\t\twidth: 100%;\n\t\theight: 96rpx;\n\t\tbackground: linear-gradient(135deg, #3b82f6, #8b5cf6);\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 600;\n\t\tborder-radius: 16rpx;\n\t\tborder: none;\n\t}\n\t\n\t.workspace-content {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\theight: 100vh;\n\t\toverflow: hidden;\n\t}\n\t\n\t.preview-panel-fixed {\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tborder-radius: 0;\n\t\tpadding: 20rpx 24rpx 24rpx 24rpx;\n\t\tbox-shadow: 0 12rpx 40rpx rgba(31, 41, 55, 0.18);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-shrink: 0;\n\t\tposition: relative;\n\t\tz-index: 10;\n\t}\n\t\n\t.preview-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 16rpx; /* 减小下边距 */\n\t\tpadding-bottom: 16rpx;\n\t\tborder-bottom: 2rpx solid #f3f4f6;\n\t}\n\t\n\t.preview-title {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t}\n\t\n\t.wrist-info {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12rpx;\n\t\tpadding: 12rpx 20rpx;\n\t\tbackground: #f3f4f6;\n\t\tborder-radius: 20rpx;\n\t\tfont-size: 24rpx;\n\t}\n\t\n\t.wrist-label {\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.wrist-style {\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t}\n\t\n\t.wrist-edit {\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.config-panel {\n\t\tflex: 1;\n\t\tbackground: #ffffff;\n\t\tborder-radius: 0 0 24rpx 24rpx;\n\t\tpadding: 30rpx;\n\t\toverflow-y: auto;\n\t\theight: 0; /* 配合 flex: 1 使用 */\n\t}\n\t\n\t.loading-text, .error-text, .empty-text {\n\t\ttext-align: center;\n\t\tpadding: 60rpx 0;\n\t\tfont-size: 28rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.error-text {\n\t\tcolor: #dc2626;\n\t}\n\t\n\t.section {\n\t\tmargin-bottom: 60rpx;\n\t}\n\t\n\t.section-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 30rpx;\n\t}\n\t\n\t.section-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #1f2937;\n\t}\n\t\n\t.back-btn {\n\t\tfont-size: 26rpx;\n\t\tcolor: #3b82f6;\n\t}\n\t\n\t.section-subtitle {\n\t\tfont-size: 26rpx;\n\t\tcolor: #6b7280;\n\t\tmargin-bottom: 24rpx;\n\t}\n\t\n\t.category-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr);\n\t\tgap: 12rpx; /* 减小间距 */\n\t}\n\t\n\t.category-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 20rpx 16rpx; /* 减小内边距 */\n\t\tborder: 3rpx solid #e5e7eb;\n\t\tborder-radius: 12rpx;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.category-item:active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t}\n\t\n\t.category-image {\n\t\twidth: 100rpx; /* 减小尺寸 */\n\t\theight: 100rpx;\n\t\tborder-radius: 50%;\n\t\tmargin-bottom: 12rpx;\n\t\tbackground: #f3f4f6;\n\t}\n\t\n\t.category-name {\n\t\tfont-size: 26rpx;\n\t\tfont-weight: 500;\n\t\tcolor: #374151;\n\t\ttext-align: center;\n\t}\n\t\n\t.product-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr); /* 改为3列，显示更多 */\n\t\tgap: 12rpx; /* 减小间距 */\n\t}\n\t\n\t.product-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 16rpx; /* 减小内边距 */\n\t\tborder: 3rpx solid #e5e7eb;\n\t\tborder-radius: 12rpx;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.product-item:active {\n\t\tborder-color: #3b82f6;\n\t\tbackground: #eff6ff;\n\t}\n\t\n\t.product-image {\n\t\twidth: 120rpx; /* 减小尺寸 */\n\t\theight: 120rpx;\n\t\tborder-radius: 12rpx;\n\t\tmargin-bottom: 12rpx;\n\t\tbackground: #f3f4f6;\n\t}\n\t\n\t.product-name {\n\t\tfont-size: 24rpx;\n\t\tfont-weight: 500;\n\t\tcolor: #374151;\n\t\ttext-align: center;\n\t\tmargin-bottom: 8rpx;\n\t}\n\t\n\t.product-price {\n\t\tfont-size: 24rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.preview-content-row {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: flex-start;\n\t\tgap: 20rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.bracelet-preview-container {\n\t\tflex: 0 0 auto;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t\n\t.preview-svg-wrapper {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t}\n\t\n\t.preview-tip {\n\t\twidth: 100%;\n\t\tpadding: 16rpx;\n\t\tborder-radius: 12rpx;\n\t\tmargin-bottom: 16rpx;\n\t\tfont-size: 22rpx;\n\t\ttext-align: center;\n\t}\n\t\n\t.preview-tip-error {\n\t\tbackground: #fef2f2;\n\t\tborder: 2rpx solid #fecaca;\n\t\tcolor: #dc2626;\n\t}\n\t\n\t.preview-tip-success {\n\t\tbackground: #f0fdf4;\n\t\tborder: 2rpx solid #bbf7d0;\n\t\tcolor: #16a34a;\n\t}\n\t\n\t.canvas-container {\n\t\twidth: 500rpx;\n\t\theight: 500rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: #ffffff;\n\t\tborder-radius: 16rpx;\n\t\toverflow: hidden;\n\t}\n\t\n\t.bracelet-canvas {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: block;\n\t}\n\t\n\t.bead-circle {\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.delete-zone {\n\t\tmargin: 20rpx 0;\n\t\tpadding: 30rpx;\n\t\tbackground: #f9fafb;\n\t\tborder: 2rpx dashed #d1d5db;\n\t\tborder-radius: 16rpx;\n\t\ttext-align: center;\n\t\ttransition: all 0.3s;\n\t\ttransform: scale(1);\n\t}\n\t\n\t.delete-zone-active {\n\t\tbackground: #fef2f2;\n\t\tborder-color: #dc2626;\n\t\tborder-style: solid;\n\t\tborder-width: 3rpx;\n\t\ttransform: scale(1.05);\n\t\tanimation: deletePulse 1s ease-in-out infinite;\n\t}\n\t\n\t@keyframes deletePulse {\n\t\t0%, 100% {\n\t\t\ttransform: scale(1.05);\n\t\t}\n\t\t50% {\n\t\t\ttransform: scale(1.08);\n\t\t}\n\t}\n\t\n\t.delete-zone-text {\n\t\tfont-size: 26rpx;\n\t\tcolor: #6b7280;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.delete-zone-active .delete-zone-text {\n\t\tcolor: #dc2626;\n\t\tfont-weight: 600;\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.preview-footer {\n\t\tborder-top: 2rpx solid #f3f4f6;\n\t\tpadding-top: 24rpx;\n\t}\n\t\n\t.empty-preview {\n\t\ttext-align: center;\n\t\tpadding: 60rpx 0;\n\t\tfont-size: 22rpx;\n\t\tcolor: #6b7280;\n\t\twidth: 400rpx;\n\t\theight: 400rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t\n\t.info-section-right {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: flex-start;\n\t\tgap: 16rpx;\n\t\tpadding: 16rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 16rpx;\n\t\tmin-height: 400rpx;\n\t}\n\t\n\t.price-section-right {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\tgap: 24rpx;\n\t\tpadding: 20rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 16rpx;\n\t\tmin-height: 500rpx;\n\t}\n\t\n\t/* 材料选择区域 */\n\t.material-panel {\n\t\tflex: 1;\n\t\theight: 66.67vh; /* 占屏幕三分之二高度 */\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tbackground: rgba(255, 255, 255, 0.95);\n\t\tborder-radius: 0;\n\t\toverflow: hidden;\n\t}\n\t\n\t/* 主tab */\n\t.main-tabs {\n\t\tdisplay: flex;\n\t\tborder-bottom: 2rpx solid #e5e7eb;\n\t\tbackground: #ffffff;\n\t}\n\t\n\t.main-tab-item {\n\t\tflex: 1;\n\t\tpadding: 24rpx 0;\n\t\ttext-align: center;\n\t\tfont-size: 28rpx;\n\t\tcolor: #6b7280;\n\t\tposition: relative;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.main-tab-item.active {\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t}\n\t\n\t.main-tab-item.active::after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: 4rpx;\n\t\tbackground: #3b82f6;\n\t}\n\t\n\t/* 材料内容区域 */\n\t.material-content {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\toverflow: hidden;\n\t}\n\t\n\t.material-tab-content {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\toverflow: hidden;\n\t}\n\t\n\t/* 子tab（左侧） */\n\t.sub-tabs {\n\t\twidth: 200rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-right: 2rpx solid #e5e7eb;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\toverflow-y: auto;\n\t}\n\t\n\t.sub-tab-item {\n\t\tpadding: 32rpx 24rpx;\n\t\tfont-size: 26rpx;\n\t\tcolor: #6b7280;\n\t\ttext-align: center;\n\t\tborder-bottom: 1rpx solid #e5e7eb;\n\t\ttransition: all 0.3s;\n\t}\n\t\n\t.sub-tab-item.active {\n\t\tbackground: #ffffff;\n\t\tcolor: #3b82f6;\n\t\tfont-weight: 600;\n\t\tborder-right: 4rpx solid #3b82f6;\n\t}\n\t\n\t/* 商品列表（右侧） */\n\t.product-list {\n\t\tflex: 1;\n\t\tpadding: 20rpx;\n\t\toverflow-y: auto;\n\t}\n\t\n\t.product-list-full {\n\t\tflex: 1;\n\t\tpadding: 20rpx;\n\t\toverflow-y: auto;\n\t}\n\t\n\t.price-section {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 24rpx;\n\t\tpadding: 20rpx;\n\t\tbackground: #f9fafb;\n\t\tborder-radius: 16rpx;\n\t}\n\t\n\t.price-info {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: flex-start;\n\t\tgap: 8rpx;\n\t}\n\t\n\t.price-label {\n\t\tfont-size: 24rpx;\n\t\tcolor: #6b7280;\n\t}\n\t\n\t.price-value {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #3b82f6;\n\t}\n\t\n\t.save-section {\n\t\tmargin-top: 60rpx;\n\t\tmargin-bottom: 40rpx;\n\t\tpadding-top: 40rpx;\n\t\tborder-top: 2rpx solid #f3f4f6;\n\t}\n\t\n\t.save-btn {\n\t\twidth: 100%;\n\t\theight: 96rpx;\n\t\tbackground: linear-gradient(135deg, #8b5cf6, #ec4899);\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 600;\n\t\tborder-radius: 16rpx;\n\t\tborder: none;\n\t\tmargin-top: 20rpx;\n\t}\n\t\n\t.save-btn[disabled] {\n\t\topacity: 0.5;\n\t}\n\t\n\t/* 紧凑版保存区域 */\n\t.save-section-compact {\n\t\tpadding: 20rpx;\n\t\tborder-top: 2rpx solid #e5e7eb;\n\t\tbackground: #ffffff;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tgap: 16rpx;\n\t}\n\t\n\t.save-form-item {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tgap: 12rpx;\n\t}\n\t\n\t.save-label {\n\t\tfont-size: 24rpx;\n\t\tcolor: #6b7280;\n\t\twhite-space: nowrap;\n\t}\n\t\n\t.save-input {\n\t\tflex: 1;\n\t\theight: 64rpx;\n\t\tpadding: 0 16rpx;\n\t\tbackground: #f9fafb;\n\t\tborder: 2rpx solid #e5e7eb;\n\t\tborder-radius: 8rpx;\n\t\tfont-size: 24rpx;\n\t\tcolor: #1f2937;\n\t}\n\t\n\t.save-btn-compact {\n\t\tflex: 0 0 120rpx;\n\t\theight: 64rpx;\n\t\tbackground: linear-gradient(135deg, #8b5cf6, #ec4899);\n\t\tcolor: #ffffff;\n\t\tfont-size: 24rpx;\n\t\tfont-weight: 600;\n\t\tborder-radius: 8rpx;\n\t\tborder: none;\n\t\twhite-space: nowrap;\n\t}\n\t\n\t.save-btn-compact[disabled] {\n\t\topacity: 0.5;\n\t}\n</style>\n","import MiniProgramPage from '/Users/shaomaojia/Documents/HBuilderProjects/bracelet/pages/workspace/workspace.vue'\nwx.createPage(MiniProgramPage)"],"names":["calculateTotalPrice","uni","productAPI","categorizeProducts","designAPI","getProductImage","getProductPrice","getProductDiameter","getProductWeight","parseDiameter","parseWeight","generateId","x","y"],"mappings":"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"}